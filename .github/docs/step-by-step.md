# Passo a passo do curso.dev

```
quinta-feira, 28 de marÃ§o de 2024
```

## Dia 1

### Bem vindo(a)!

Seja muito bem vindo ou bem vinda Ã  primeira aula do /web! ğŸ‰ ğŸ¤ ğŸ‘

Esta primeira aula serve para vocÃª:

1. Aquecer os motores
2. Fazer o seu primeiro comentÃ¡rio
3. E coletar os seus primeiros Pontos de ExperiÃªncia (XP) ao marcar a aula como concluÃ­da.

### Como estÃ£o organizadas as aulas?

Um dos segredos de uma plataforma educacional de sucesso Ã© a forma como os conteÃºdos estÃ£o organizados porque essa organizaÃ§Ã£o pode contribuir ou nÃ£o com o progresso do aluno, principalmente se sentir estimulado ou desestimulado a concluir as aulas.

E falar sobre isto Ã© muito mais importante do que parece, pois a maioria das pessoas acabam nÃ£o concluÃ­ndo os cursos que se matriculam e vejo que a maioria das plataformas de ensino nÃ£o ajudam nesta questÃ£o.

EntÃ£o nessas horas, nada melhor do que usar a biologia do corpo humano para contribuir com o ritmo do aluno durante o progresso das aulas ğŸ¤

### Pista RÃ¡pida e Pista Lenta

Nesta aula eu trago o conceito de Fast Lane (ğŸš— Pista RÃ¡pida) e Slow Lane (Pista Lenta) e como isso vai ser importante para comportar pessoas em diferentes nÃ­veis de habilidade em programaÃ§Ã£o.

E o massa Ã© que isso abre a oportunidade para eu conseguir criar mais conteÃºdos profundos quando alguÃ©m precisar ou algum conteÃºdo extra para reforÃ§o de algum conceito que ainda nÃ£o ficou claro, sem atrapalhar o avanÃ§o macro do projeto e do curso ğŸ’ª

Como isto Ã© representado dentro da plataforma?
Ã“tima pergunta e tudo que estiver com o Ã­cone ğŸš— Ã© uma Pista RÃ¡pida e o restante de todas as outras aulas automaticamente se enquadram na categoria de Pista Lenta.

EntÃ£o vocÃª irÃ¡ notar que um Dia aqui na plataforma Ã© geralmente representado por uma ğŸš— Pista RÃ¡pida e vÃ¡rias Pistas Lentas que vem em seguida, conforme a ilustraÃ§Ã£o abaixo sobre o Dia 2:

[Exemplo de Pista RÃ¡pida e Pista Lenta](../assets/pista-rapida-e-pista-lenta.png)

## Dia 2

### ğŸš— Pista RÃ¡pida

Esta Ã© a primeira Pista RÃ¡pida (FastTrack) do curso.dev e nela eu dou um rÃ¡pido resumo dos principais pontos que foram discutidos ao longo das aulas encontradas no Dia 2. Fora isso, eu incentivo pessoas com mais senioridade na Ã¡rea de tecnologia a conferirem as aulas na Pista Lenta, pois nelas serÃ£o encontradas analogias que podem ser utilizadas para a pessoa explicar estes conceitos para outras pessoas.

AtenÃ§Ã£o
Para compartilhar o seu perfil e consultar o perfil de outros alunos, peÃ§o que faÃ§a isso na aula Git? GitHub? Ã‰ tudo a mesma coisa?

VocÃª vai encontrar lÃ¡ muuuuitos perfis legais ğŸ’ª

### Git? GitHub? Ã‰ tudo a mesma coisa?

Nesta aula eu trago uma analogia parar esclarecer uma confusÃ£o comum entre GitHub e Git, onde apesar de ser uma visÃ£o superficial do que Ã© cada uma destas coisas, eu acredito que esta analogia irÃ¡ servir atÃ© para vocÃª ensinar para outra pessoa qual a diferenÃ§a entre estas duas ferramentas.

E nas prÃ³ximas aulas iremos sair da teoria para visualizar na prÃ¡tica como usar o GitHub e o que Ã© de fato um repositÃ³rio .git

Site do GitHub: https://github.com/
Site do Git: https://git-scm.com/

### RepositÃ³rio: onde tudo comeÃ§a

Tudo comeÃ§a na criaÃ§Ã£o do repositÃ³rio (em inglÃªs repository), que Ã© onde vocÃª irÃ¡ guardar os arquivos do seu projeto e o histÃ³rico de alteraÃ§Ã£o deles, e nesta aula eu explico todos os detalhes de como fazer isto na interface do GitHub.

E esta Ã© uma aula bastante especial, pois traz estatÃ­sticas sobre o TabNews que nÃ£o estÃ£o pÃºblicas e tambÃ©m fotos de uma Ã©poca onde eu trabalhava com Bolsa de Valores, e sÃ³ assistindo a aula para entender ğŸ¤

### Ambiente de Desenvolvimento

Quanto mais simples for um ambiente de desenvolvimento, maior flexibilidade vocÃª terÃ¡ e, numa visÃ£o grosseira, nÃ£o deveria passar de um lugar para escrever cÃ³digos e outro lugar para executar eles ou outros serviÃ§os.

ğŸš¨ ConfiguraÃ§Ãµes
EntÃ£o na lista abaixo vocÃª irÃ¡ encontrar aulas nÃ£o listadas sobre como configurar um ambiente de desenvolvimento com as dependÃªncias mÃ­nimas para conseguir escrever e executar o projeto do TabNews:

- Codespaces (recomendado)
- Gitpod (em construÃ§Ã£o)
- Windows Localhost (em construÃ§Ã£o)
- macOS Localhost (em construÃ§Ã£o)
- Linux Localhost (em construÃ§Ã£o)

### Codespaces

O Codespaces Ã© um ambiente de desenvolvimento completo fornecido de forma gratuita pelo GitHub onde Ã© disponibilizado para vocÃª tanto um editor de cÃ³digo, que nesse caso Ã© o super popular VSCode, quanto um terminal que por padrÃ£o roda Linux... Ã© tudo o que a gente precisa!

## Dia 3

### ğŸš— Pista RÃ¡pida

Nesta Pista RÃ¡pida sÃ£o tratados assuntos muito importantes para o projeto, como por exemplo: qual versÃ£o utilizar do Node.js, Next.js, React e React DOM.

E caso vocÃª jÃ¡ saiba instalar as dependÃªncias e queira sÃ³ copiar e colar as versÃµes que apareceram no vÃ­deo, segue abaixo:

nodejs lts/hydrogen
next@13.1.6
react@18.2.0
react-dom@18.2.0

### A fundaÃ§Ã£o

Nesta aula eu destaco uma frase do Carl Sagan que se conecta perfeitamente com o que acontece no mundo da tecnologia e programaÃ§Ã£o... inclusive com o que acontece dentro desta prÃ³pria aula ao configurar o Node.js, a fundaÃ§Ã£o do projeto, utilizando o utilitÃ¡rio nvm.

### A primeira parede

Com a base feita na aula passada, a gente vai agora comeÃ§ar a levantar as paredes (o que de fato vai dar pra comeÃ§ar a â€œtocarâ€ do nosso sistema), e o primeiro mÃ³dulo/framework que a gente vai utilizar pra fazer isso Ã© o Next.js.

Site do framework: https://nextjs.org/
Site da empresa por trÃ¡s: https://vercel.com/

#### Let's code

Crie o projeto `clone-tabnews` no `GitHub` e marque a opÃ§Ã£o para criar o `README`, depois faÃ§a o clone do projeto

Entre na pasta `clone-tabnews` e crie o arquivo `.nvmrc`:

```
lts/hydrogen
```

execute os comandos:

```
nvm install
nvm alias default lts/hydrogen
```

```
npm i next@13.1.6 react@18.2.0 react-dom@18.2.0
```

## Dia 4

### ğŸš— Pista RÃ¡pida

Eu nÃ£o podia comeÃ§ar esta Pista RÃ¡pida de outra forma, a nÃ£o ser agradecendo a participaÃ§Ã£o de todos na plataforma e destacando alguns comentÃ¡rios com palavras que me empurram lÃ¡ pra cima e me dÃ£o um gÃ¡s ainda mais forte pra eu nÃ£o medir esforÃ§os e criar as melhores aulas do mundo. E Ã© injusto a quantidade de comentÃ¡rios que coloquei ali no vÃ­deo em comparaÃ§Ã£o a todos os comentÃ¡rios deixados na plataforma, mas o vÃ­deo ficaria abarrotado de comentÃ¡rios... vocÃªs sÃ£o apaixonantes ğŸ˜ ğŸ’ª ğŸ¤

### Protocolos e rodando o site de forma local

Ã‰ uma honra ter uma aula como esta aqui na plataforma, pois ela irÃ¡ fazer vocÃª notar a internet de uma forma diferente, pois vocÃª vai comeÃ§ar a ver e entender Protocolos, que sÃ£o a base de toda a comunicaÃ§Ã£o que acontece entre um Cliente e Servidor, desde o seu navegador ao saber se comunicar por HTTP, atÃ© a sua rede que sabe se comunicar por TCP atravÃ©s do IP. AlÃ©m disso, a missÃ£o desta aula Ã© levantar o Servidor Web... serÃ¡ que vamos conseguir?

VÃ­deo do UDP vs TCP: https://youtu.be/ZEEBsq3eQmg

### PÃ¡gina inicial

Depois de uma rÃ¡pida dica sobre como limpar o seu terminal usando clear ou CTRL + L, chegou a hora de subir de verdade o nosso Servidor Web, mas para isso, precisamos de uma pÃ¡gina de verdade e nÃ£o poderia ser diferente, a nÃ£o ser comeÃ§ar com a index.

AlÃ©m disso, eu mostro um recurso interessante no Codespaces sobre como deixar as suas rotas de forma pÃºblica e ainda com live-reload.

#### Let's code

Crie o arquivo `src/pages/index.js`:

```jsx
export default () => <h1>Home</h1>
```

adicione o `script` no arquivo `package.json`:

```json
{
  "scripts": {
    "dev": "next dev"
  }
}
```

execute o comando de inicializaÃ§Ã£o:

```
npm run dev
```

### Um desafio importante

Turma, nessa aula eu trago um desafio simples, porÃ©m muito importante e trata de algo que eu suplicaria para que eu domasse isso no passado ou, pelo menos, que toda a cadeia de gestores e lÃ­deres que estivesse acima de mim na hierarquia tivessem domado ğŸ¤

**AtenÃ§Ã£o** ğŸ›‘

VocÃª nÃ£o precisa executar o desafio aqui agora, inclusive este nÃ£o Ã© o objetivo desta aula, pois as prÃ³ximas aulas irÃ£o lhe dar o conhecimento tÃ©cnico para executar isto da melhor forma. Esta aula aqui serviu apenas para inaugurar o desafio e comeÃ§ar a alinhar a sua mente sobre o que importa no final das contas ğŸ¤

**AtenÃ§Ã£o 2** ğŸ›‘

A Vercel implementou um novo sistema de seguranÃ§a nos deploys chamado de Deployment Protection. Isto Ã© um Ã³timo recurso, mas caso vocÃª queira rapidamente passar a URL de algum deploy especÃ­fico para alguÃ©m, uma alternativa Ã© temporariamente desabilitar esta opÃ§Ã£o para que o servidor se comporte como antigamente. Para isto, siga estas instruÃ§Ãµes e desabilite o recurso ğŸ¤

#### Let's code

Crie o arquivo `.gitignore`:

```
node_modules
.next
```

e adicione mais um `script` no arquivo `package.json`:

```json
{
  "scripts": {
    "start": "next start"
  }
}
```

suba as alteraÃ§Ãµes para o GitHub:

```
git add .
git commit -m "next app"
git push origin main
```

faÃ§a o login em https://vercel.com/ e realize o deploy do projeto no GitHub

https://clone-tabnews-diasjoaovitor.vercel.app/

## Dia 5

### ğŸš— Pista RÃ¡pida

O Dia 5 Ã© um dia mais longo que os outros dias e as Pistas Lentas desse dia sÃ£o bem densas. Escolhi fazer um Dia assim porque nÃ£o queria quebrar um raciocÃ­nio muito importante que vou explicar apenas aqui nessa Pista RÃ¡pida ğŸ¤

Lista de comandos abordados

- `git log`: listar os commits do repositÃ³rio.
- `git add`: sobe alteraÃ§Ãµes para a staging area.
- `git commit`: realiza novos commits.
- `git commit --amend`: substitui o commit anterior por um novo, mas aproveita as alteraÃ§Ãµes dele.
- `git diff`: calcula a diferenÃ§a entre as versÃµes/alteraÃ§Ãµes dos arquivos.

Todos estes comandos funcionam de forma offline no Git e podem ser usados sem a necessidade de uma conexÃ£o com a internet, pois nenhum deles transmite informaÃ§Ãµes para fora do seu computador.

### Onde fica o "Git"? E como era feito antes disso?

Nesta Pista Lenta nÃ³s vamos revisitar a histÃ³ria dos versionadores de cÃ³digo para entender a diferenÃ§a entre o modelo centralizado e distribuÃ­do, e tambÃ©m pincelar como que as pessoas faziam para lidar com versionamento antes de inventarem os controladores de versÃ£o. AlÃ©m disso, mostro como utilizar o Local History, um recurso muito interessante do VSCode, falo sobre Merge Conflict e onde que fica a pasta .git.

### Git Log (e o Jogo dos 7 Erros)

Topa jogar o Jogo dos 7 erros comigo? Tudo em nome de aprender git, mas mais especificamente o mecanismo de diff, pois isto vai ser um "plot twist" numa confusÃ£o que muita gente faz sobre os bastidores de como o git funciona e gerencia o seu histÃ³rico de arquivos. Fora que, entendendo isso, vai abrir sua mente sobre o que Ã© retornado pelo comando git log (e como).

### Git Commit (e a Escada Infinita)

Agora que a gente jÃ¡ sabe usar o git para ver os commits (as fotos) que o nosso repositÃ³rio possui, chegou a hora de entender quais sÃ£o os 3 estÃ¡gios que um arquivo pode passar nessa histÃ³ria de controle de versÃ£o.

### Git Diff e Amend (e a Viagem no Tempo)

Eu gostaria de comeÃ§ar a aula de hoje falando sobre um poder que vocÃª tem, que Ã© de viajar no tempo. Sim, vocÃª tem em mÃ£os uma mÃ¡quina do tempo, que nÃ£o Ã© tÃ£o massa quanto um Delorean, mas que Ã© o git e com ele vocÃª consegue sim viajar no tempo e mudar as coisas que aconteceram... pelo menos dentro do seu repositÃ³rio. EntÃ£o para isto, nÃ³s iremos aprender a usar o comando `git commit --amend`.

> **YuriHassle**

Caso vocÃª deseje emendar um commit sem alterar a mensagem, Ã© possÃ­vel passar a flag --no-edit. Com isso, a mensagem anterior serÃ¡ preservada e a tela de ediÃ§Ã£o nÃ£o serÃ¡ aberta. Ex: git commit --amend --no-edit

---

> **zamorano**

Para aqueles que precisarem de uma consulta rÃ¡pida dos comandos mais utilizados do GIT (GIT Cheat Sheet): https://education.github.com/git-cheat-sheet-education.pdf

## Dia 6

### ğŸš— Pista RÃ¡pida

Se vocÃª achou o Dia anterior, o Dia 5, massa... o Dia 6 vai ser ainda mais massa! Isso porque a gente vai furar a bolha do repositÃ³rio local e comeÃ§ar a executar comandos git que influenciam tambÃ©m o repositÃ³rio remoto, o origin que estÃ¡ lÃ¡ no GitHub.

Lista de comandos abordados

- `git commit -m "mensagem"`: atalho para fazer novos commits.
- `git push` - empurrar alteraÃ§Ãµes locais para o origin.
- `git push --force` - empurrar de forma forÃ§ada alteraÃ§Ãµes locais para o origin.
- `git push -f` - a forma comprimida do comando anterior.

Tirando o comando relacionado aos commits, todos os comandos de push funcionam apenas de forma online e devem ser usados com uma conexÃ£o com a internet ativa, pois eles transmitem informaÃ§Ãµes para fora do seu computador (isso assumindo que o seu origin estÃ¡ lÃ¡ no GitHub).

### Git Push

Nesta Pista Lenta vamos aprender a usar o git push e qual o resultado disto no origin (o repositÃ³rio de origem). Isto Ã© uma mecÃ¢nica fundamental para vocÃª utilizar no compartilhamento de novas melhorias no repositÃ³rio, sejam elas novas features, ajustes ou qualquer coisa que empurre a linha do tempo do seu repositÃ³rio para frente. Falando nisso, nÃ³s iremos tambÃ©m ver de forma superficial duas linhas do tempo importantes, a origin/main e local/main.

### Fazendo commits de forma mais rÃ¡pida

Neste vÃ­deo vamos fazer vÃ¡rias coisas, inclusive nos colocar numa posiÃ§Ã£o problemÃ¡tica porÃ©m vida real ğŸ¤

De qualquer forma, o destaque da aula Ã© um atalho para fazer novos commit, um atalho que possivelmente vai se tornar a forma padrÃ£o de vocÃª fazer eles ğŸ’ª

### Git Push De Novo (mas agora com ainda mais "forÃ§a")

Nesta Pista Lenta serÃ¡ ensinado um dos recursos mais perigosos do Git, que Ã© fazer o push, porÃ©m usando a opÃ§Ã£o force. Fora isso, Ã© uma Ã³tima aula para revisar outros comandos como o amend e os efeitos colaterais que ele causa no commit anterior, na linha do tempo da sua branch local e a relaÃ§Ã£o disto tudo com a mesma branch lÃ¡ no origin.

## Dia 7

### ğŸš— Pista RÃ¡pida

O Dia 7 comeÃ§a a separar quem estÃ¡ na Ã¡rea de tecnologia para ser um profissional valorizado e que quer se sentir uma pessoa importante... de quem que tÃ¡ sÃ³ de brincadeira.

### Client e Server

Existe uma relaÃ§Ã£o extremamente importante em qualquer camada da tecnologia, que Ã© a relaÃ§Ã£o entre cliente e servidor (ou client e server). Algumas pessoas comeÃ§am a se confundir sobre quem Ã© o client e quem Ã© o server, pois eles nÃ£o sÃ£o papeis fixos e dependem do que exatamente estes componentes estÃ£o fazendo. Ter a modelagem correta na mente sobre isso Ã© algo valioso, pois ela destrava novas percepÃ§Ãµes sobre a arquitetura de todos os softwares envolvidos em um sistema.

### Hospedagem e Deploy

Chegou a hora de hospedar o nosso site e comeÃ§ar a realizar deploys! EntÃ£o para vocÃª ter uma base sÃ³lida neste tÃ³pico, nÃ³s vamos rapidamente passar pela evoluÃ§Ã£o de como as pessoas faziam deploy e serviam sites na internet. Depois, vamos realizar o nosso prÃ³prio deploy, tudo isso com a ajuda de um novo integrante da equipe ğŸ˜

### Fazendo novos Deploys

Deploy Ã© uma parte crucial de um profissional que trabalha com programaÃ§Ã£o e que quer ver suas implementaÃ§Ãµes e ideias saindo do papel e encostando na realidade. EntÃ£o nesta aula vamos entender melhor a dinÃ¢mica do Continuous Deployment da Vercel, incluindo a funcionalidade das suas URLs permanentes e como tudo isso contribui para vocÃª ver os cÃ³digos que vocÃª programa disponÃ­veis publicamente na internet

Preciso da sua ajuda com o Epilif ğŸ¤
Se vocÃª tiver um tempinho extra, por favor, eu peÃ§o que vocÃª entre na aula nÃ£o listada abaixo, pois estou precisando de uma ajuda:

- [Resolvendo um problema com Epilif](https://curso.dev/web/epilif-ajustando-frase)

### Resolvendo um problema com Epilif

Que bom que vocÃª acessou essa aula nÃ£o listada, porque eu preciso da sua ajuda pra resolver um problema muito sÃ©rio com o Epilif, que Ã© dele ter colocado minha frase pra Renata no ar mas no site dele! ğŸ˜¡

### Encerramento do Desafio (Resultados de todo mundo) ğŸ‰

VocÃª chegou no encerramento do Primeiro Desafio ğŸ‰ ğŸ‰ ğŸ‰

Eu sinceramente estou muito feliz por isso! Ã‰ algo que vai ser muito importante pra vocÃª, pra mim e tambÃ©m pra todos os outros alunos que passarem pela mesma experiÃªncia, porque que agora todos nÃ³s temos garantidamente algo em comum ğŸ¤

Boas prÃ¡ticas para compartilhar o desafio nos comentÃ¡rios
Ao compartilhar o seu desafio nos comentÃ¡rios desta aula, sugiro seguir os 3 passos abaixo para entendermos melhor o que aconteceu no seu desafio:

1. Escreva um rÃ¡pido contexto, por exemplo: Quem era a pessoa que vocÃª enviou a URL?
2. Dado que a Vercel gera uma URL Ãºnica do commit no momento de um Deploy, compartilhe conosco este link que Ã© permanente. Por exemplo, o link do meu commit com a frase Ã© este: https://clone-tabnews-6o0vcvooy-filipedeschamps.vercel.app/
3. E por Ãºltimo: Qual foi a reaÃ§Ã£o da pessoa? ğŸ˜

**AtenÃ§Ã£o** ğŸ›‘

A Vercel implementou um novo sistema de seguranÃ§a nos deploys chamado de Deployment Protection. Isto Ã© um Ã³timo recurso, mas caso vocÃª queira rapidamente passar a URL de algum deploy especÃ­fico para alguÃ©m, uma alternativa Ã© temporariamente desabilitar esta opÃ§Ã£o para que o servidor se comporte como antigamente. Para isto, siga [estas instruÃ§Ãµes](https://vercel.com/docs/security/deployment-protection#understanding-deployment-protection-by-environment) e desabilite o recurso ğŸ¤

## Pitstop ğŸ

### Se vocÃª puder ajudar, eu agradeÃ§o muito ğŸ¤

Muito obrigado por fazer este Pitstop ğŸ¤ ğŸ¤ ğŸ¤ Este Ã© um momento extremamente importante para o curso.dev, para mim e para minha famÃ­lia ğŸ™

SugestÃµes
Caso vocÃª queira dar um depoimento, mas nÃ£o sabe o que abordar, segue abaixo algumas sugestÃµes:

1. Valeu a pena atÃ© o momento ter se matriculado?
2. Se vocÃª Ã© iniciante, estÃ¡ valendo a pena?
3. Ou se vocÃª nÃ£o Ã© mais iniciante, tambÃ©m estÃ¡ valendo a pena?
4. Se vocÃª veio de outra Ã¡rea, estÃ¡ sendo possÃ­vel dar â€œconta do recadoâ€ e aprender de verdade?
5. O que vocÃª estÃ¡ achando da didÃ¡tica? EstÃ¡ dando para aprender mesmo?
6. O que vocÃª achou da mecÃ¢nica da Pista RÃ¡pida e Pista Lenta?
7. A plataforma ajuda a ter vontade de fazer as aulas? Ã‰ algo prazeroso? Faz vocÃª se sentir mais prÃ³ximo do professor?
8. O professor gosta do que faz? Isso se reflete no material e no carinho com os alunos?
9. VocÃª estÃ¡ aprendendo aqui coisas diferentes (ou de formas diferentes) do que em outros cursos?
10. Mesmo que neste estÃ¡gio do curso, vocÃª amadureceu, sente mais coragem ou competÃªncia?

**AtenÃ§Ã£o** ğŸ›‘

Tudo que vocÃª escrever abaixo ficarÃ¡ pÃºblico na Home (https://curso.dev/), junto como o seu username. E como estÃ¡ sendo utilizado o exato mesmo sistema de comentÃ¡rios das outras aulas, vocÃª poderÃ¡ interagir com outros depoimentos, seja adicionando novos comentÃ¡rios ou qualificando. Esta Ã© uma Ã¡rea controlada pelos alunos ğŸ’ª

Eu sÃ³ irei interferir caso algum depoimento ou comentÃ¡rio venha ferir os Termos de Uso da plataforma, combinado? ğŸ¤

## Dia 8

### ğŸš— Pista RÃ¡pida

Nos Dias anteriores a gente afiou alguns conhecimentos pra pular algumas barreiras tÃ©cnicas e tambÃ©m alguns conhecimentos pra pular algumas barreiras iniciais de negÃ³cio... e agora chegou a hora da gente afiar diretamente a ferramenta mais importante de todas... o seu cÃ©rebro ğŸ’ª

### ProgramaÃ§Ã£o "OrgÃ¢nica" versus "Impressora 3D"

Se segura na cadeira, porque daqui pra frente a gente vai aprender sobre MUITA coisa tÃ©cnica, muita mesmo, e que vai ser coberto aqui dentro do curso.dev de um jeito que sÃ³ dÃ¡ para fazer por aqui ğŸ¤

### Por que meus projetos sempre dÃ£o certo?

Falar que "os meus projetos sempre dÃ£o certo" Ã© uma afirmaÃ§Ã£o muito forte e eu concordo, mas teve um evento que aconteceu comigo lÃ¡ no passado (quando eu mexia com Bolsa de Valores) que mudou a minha vida pra sempre.

Ã‰ um evento que vai se conectar com um mÃ³dulo Node.js meu ficando na primeira pÃ¡gina do site Hacker News e quem conhece esse site sabe o quÃ£o difÃ­cil Ã© conseguir isso, e que se conecta tambÃ©m com eu receber uma mensagem privada no Twitter de uma pessoa que eu sou muito fÃ£.

## Dia 9

### ğŸš— Pista RÃ¡pida

Se vocÃª quer se divertir programando projetos tanto quanto vocÃª se diverte, por exemplo, jogando video games... o Dia 9 existe pra atingir justamente isso ğŸ’ª

### Qual o â€œsegredoâ€ para organizaÃ§Ã£o de tarefas?

Fazer muito com pouco e nÃ£o pouco com muito... esse Ã© um dos segredos que eu percebi quando o assunto Ã© organizaÃ§Ã£o de tarefas.

Vamos mapear como estÃ¡ o mercado?
Se vocÃª estiver envolvido em algum projeto (mesmo que pessoal), por favor, utilize a seÃ§Ã£o de comentÃ¡rios para compartilhar:

1. Quantas pessoas aproximadamente estÃ£o envolvidas nesse projeto?
2. Quais softwares estÃ£o sendo usados?
3. Quais metodologias estÃ£o sendo aplicadas?

> **devrodrigo**

tenho como exemplo o meu resumo da aula de hoje no notion:

- Fazer muito com pouco e nÃ£o pouco com muito.
- Quando se planeja muito, em excesso, normalmente, se executa pouco. Quando se planeja pouco, se executa muito, mas com efeitos colaterais como arquitetura ou modelagem ruim.
- Ã‰ preciso calcular o saldo das coisas que sÃ£o feitas para determinar se vale a pena ou nÃ£o continuar dessa forma.
- Dar um passo para trÃ¡s para dar dois saltos para frente Ã© algo com o saldo positivo.
- Algo fundamental para qualquer controle de tarefas Ã© a possibilidade de se registrar o progresso da tarefa, por meio de checkboxes.
- NÃ­vel 1: Ser lembrado individualmente. (Lembrar o que eu preciso fazer)
  - Menor custo de produÃ§Ã£o (custo de energia para que eu consiga registrar o que precisa ser feito) e menor tempo de aquecimento (Quanto tempo que demora para conseguir ver e conferir o que precisa ser feito).
  - Como, por exemplo, anotaÃ§Ãµes em um papel e sem detalhes, somente com o nome das tarefas, de forma que fique fÃ¡cil de acessar, ler e lembrar.
- NÃ­vel 2: Ser lembrado em grupo. (Lembrar um grupo de pessoas sobre suas tarefas)
  - Quadros de Kanban sÃ£o Ã³timos para conseguir criar novas tarefas e relembrar um grupo de pessoas do que precisa ser feito sem levar tempo de aquecimento algum.
- NÃ­vel 3: Expandir conhecimento.
  - Conversar e desenvolver de uma forma detalhada o que e como algo deve ser feito.
  - MÃ©dio custo de produÃ§Ã£o e mÃ©dio tempo de aquecimento.
- NÃ­vel 4: Gerar mÃ©tricas.
  - Conseguir mensurar a produtividade das pessoas que estÃ£o trabalhando nas mÃ©tricas.
  - Alto custo de produÃ§Ã£o e alto tempo de aquecimento.
  - Pode ser visto como mais cansativo do que a prÃ³pria tarefa em si, mas Ã© essencial para a gestÃ£o do projeto.
  - Muito perigoso quando se olha mais para as barreiras de tecnologia avanÃ§adas do que para as barreiras de negÃ³cios avanÃ§adas.
- JIRA - VisÃ£o geral de quantas tarefas sÃ£o necessÃ¡rias para finalizar o projeto em relaÃ§Ã£o com quantas foram executadas semanalmente. Permite mostrar que estÃ¡ sendo executado mais tarefas mas que tambÃ©m o nÃºmero de tarefas necessÃ¡rias estÃ¡ aumentando de uma forma muito simples.

  - Por exemplo:

  |            | Semana 1 | Semana 2 | Semana 3 |
  | ---------- | -------- | -------- | -------- |
  | Total      | 100      | 140      | 150      |
  | Executadas | 70       | 90       | 115      |
  | ConclusÃ£o  | 70%      | 64%      | 77%      |

---

### Como peitar projetos de qualquer tamanho?

VocÃª gosta de comer pedra? NÃ£o responde ainda! ğŸ˜‚ Deixa eu falar algo antes ğŸ¤

Deixa eu te preparar pra que, se vocÃª se pegar numa situaÃ§Ã£o em que o seu cÃ©rebro estÃ¡ tentando negociar com vocÃª um "tudo ou nada", por exemplo: "ou programa o sistema inteiro que vocÃª quer fazer nesse final de semana ou nÃ£o faz nada" Ã© porque ele quer que vocÃª faÃ§a nada... sabe por que? A resposta estÃ¡ na aula ğŸ˜

### Criando a primeira Milestone e Issues do Projeto

Nesta Pista Lenta iremos criar tanto a Milestone 0: Em construÃ§Ã£o, quanto as 3 Issues abaixo:

- Colocar o site num domÃ­nio .com.br
- Definir estilizaÃ§Ã£o do cÃ³digo e configurar editor
- Programar pÃ¡gina de "Em construÃ§Ã£o"

Fora conversar sobre a mecÃ¢nica do neurotransmissor mais importante quando o assunto Ã© se sentir motivado a iniciar, continuar e concluir tarefas.

## Dia 10

### ğŸš— Pista RÃ¡pida

NÃ£o sei se vocÃª notou, mas a gente estÃ¡ passando um pente fino em tudo e no Dia 10 nÃ£o vai ser diferente. Eu digo isso porque eu jÃ¡ conversei com muitos desenvolvedores seniores que eram â€œseniores ocosâ€... e eu nÃ£o estou querendo machucar ninguÃ©m falando isso. Primeiro porque Ã© algo muito comum, muito mais comum do que muita gente que ainda nÃ£o Ã© sÃªnior possa imaginar que seja assim, e segundo e mais importante, nas conversas que eu tive, a prÃ³pria pessoa revelava isso (de ter essa inseguranÃ§a) e isso foi um dos grandes motivos de eu colocar na mensagem principal do curso.devâ€¦que "se sentir competente em programaÃ§Ã£o comeÃ§a aqui".

EntÃ£o pra isso acontecer, pra de verdade se sentir completamente competente, nÃ£o tem pra onde escapar... Ã© preciso trabalhar o lado pessoal/profissional e o lado tÃ©cnico e o Dia 10 junta essas duas coisas ğŸ’ª

### Uma histÃ³ria macabra sobre "EstilizaÃ§Ã£o de CÃ³digo"

No compromisso de fazer o download do meu cÃ©rebro, eu nÃ£o posso apenas ensinar a parte tÃ©cnica de algo que eu acredito ser importante. Eu preciso compartilhar com vocÃª eventos da "vida real" que aconteceram e que, aÃ­ sim, concretizam a importÃ¢ncia da parte tÃ©cnica. Isso Ã© o que irÃ¡ fazer grudar na sua mente o conhecimento ğŸ’ª

EntÃ£o nesta aula vou contar uma histÃ³ria que eu vivenciei no inÃ­cio do Pagar.me, onde eu espero convencer vocÃª que, estilizaÃ§Ã£o de cÃ³digo, no longo prazo, Ã© algo muito importante ğŸ¤

**Curiosidade**

[Neste comentÃ¡rio](https://curso.dev/alunos/czaghi/e5632290-0281-41ae-b7f0-a762bdc9ff09) o aluno czaghi diz que encontrou o PR que eu citei na aula ğŸ˜‚

### SincronizaÃ§Ã£o das configuraÃ§Ãµes do Editor

Esta Ã© uma aula mais especÃ­fica ao Codespaces ou atÃ© VS Code e que serve como referÃªncia para outros editores sobre uma feature para sincronizaÃ§Ã£o na nuvem de configuraÃ§Ãµes.

Mas independente disto, a parte mais importante Ã© que nesta aula iremos aprender a dividir uma Issue em Tarefas e concluir a primeira Tarefa da Milestone ğŸ‰

### Configurar o EditorConfig

O EditorConfig Ã© um Configurador de Editor e por ele a gente vai definir regras fundamentais de como o seu Editor deve se comportar como, por exemplo, qual a largura da indentaÃ§Ã£o do cÃ³digo, se serÃ¡ uma indentaÃ§Ã£o mais curta ou mais comprida e se nela deve usar o caractere de espaÃ§o ou tab. Mas importante destacar que essas regras irÃ£o acontecer antes de vocÃª salvar um arquivo... guarde esta informaÃ§Ã£o para a prÃ³xima aula ğŸ¤

#### Let's code

Crie o arquivo `.editorconfig` e instale [sua extensÃ£o](https://marketplace.visualstudio.com/items?itemName=EditorConfig.EditorConfig)

```yml
root = true

[*]
indent_style = space
indent_size = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true
```

O arquivo `.editorconfig` Ã© utilizado para padronizar as configuraÃ§Ãµes de formataÃ§Ã£o do cÃ³digo-fonte em diferentes editores e IDEs. Vamos analisar cada comando:

- `root = true`: Indica que o arquivo `.editorconfig` Ã© o arquivo raiz, aplicando-se a todo o projeto.
- `[*]`: PadrÃ£o global que se aplica a todos os arquivos.
- `indent_style = space`: Define o estilo de recuo como espaÃ§os.
- `indent_size = 2`: Tamanho da indentaÃ§Ã£o (2 espaÃ§os).
- `end_of_line = lf`: Caractere de fim de linha (LF - Line Feed).
- `charset = utf-8`: Conjunto de caracteres UTF-8.
- `trim_trailing_whitespace = true`: Remove espaÃ§os em branco no final das linhas.
- `insert_final_newline = true`: Adiciona uma nova linha vazia ao final do arquivo, se ainda nÃ£o existir.

O uso do `.editorconfig` ajuda a manter a consistÃªncia na formataÃ§Ã£o do cÃ³digo, mesmo quando diferentes desenvolvedores utilizam editores diferentes. ğŸ˜Š

### Configurar o Prettier

Nesta aula iremos passar um pente fino no assunto Prettier que Ã© um dos formatadores de cÃ³digo mais famosos do mundo ğŸ’ª

A princÃ­pio, o assunto Prettier Ã© simples, e de fato Ã©, mas esta simplicidade abre espaÃ§o para brechas numa estratÃ©gia mais madura sobre a garantia da estilizaÃ§Ã£o do cÃ³digo. EntÃ£o como aqui no curso.dev minha missÃ£o Ã© nÃ£o deixar buracos no seu conhecimento, chegou a hora de estudar este assunto de forma sÃ©ria, incluindo, preparar o projeto para que ele tambÃ©m seja um projeto sÃ©rio ğŸ¤

#### Let's code

Instale o [mÃ³dulo](https://www.npmjs.com/package/prettier) e a [extensÃ£o](https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode) do [prettier](https://prettier.io/)

```
npm i -D prettier
```

defina o `prettier` como o formatador padrÃ£o do `VSCode` em `Default Formatter` e habilite a opÃ§Ã£o `Format On Save`. Para garantir a melhor praticidade quando estiver escrevendo testes automatizados, desabilite a opÃ§Ã£o `Auto Save`

VocÃª tambÃ©m pode definir essas configuraÃ§Ãµes criando o arquivo `.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "files.autoSave": "off",
  "git.autofetch": true
}
```

E definir algumas configuraÃ§Ãµes no arquivo `.prettierrc.json`:

```json
{
  "trailingComma": "none",
  "semi": false,
  "singleQuote": true
}
```

- **"trailingComma": "none"**: Indica que o Prettier nÃ£o adicionarÃ¡ vÃ­rgulas finais. Exemplo sem essa opÃ§Ã£o: `[1, 2, 3,]`. Com essa opÃ§Ã£o: `[1, 2, 3]`.

- **"semi": false**: Desativa a inserÃ§Ã£o automÃ¡tica de ponto e vÃ­rgula. Exemplo sem essa opÃ§Ã£o: `const name = 'Copilot';`. Com essa opÃ§Ã£o: `const name = 'Copilot'`.

- **"singleQuote": true**: Faz com que o Prettier use aspas simples. Exemplo sem essa opÃ§Ã£o: `const greeting = "olÃ¡"`. Com essa opÃ§Ã£o: `const greeting = 'olÃ¡'`.

Finalmente, adicione os `scripts`:

```json
{
  "scripts": {
    "dev": "next dev",
    "lint:check": "prettier --check .",
    "lint:fix": "prettier --write ."
  }
}
```

### ğŸ Extra: Configurar o Prettier Ignore

Algo aconteceu no meu ambiente de desenvolvimento que foi diferente do que aconteceu no ambiente de alguns outros alunos quando executaram o script npm run lint:check ou npm run lint:fix. Nesta aula vamos investigar o que aconteceu e o que fazer para deixar tudo sincronizado ğŸ’ª

ğŸ›‘ **Breaking Change**

O prettier a partir da versÃ£o 3.0.0 mudou o seu comportamento e por padrÃ£o estÃ¡ utilizando o conteÃºdo dentro .gitignore para tambÃ©m ignorar o linting de estilizaÃ§Ã£o ğŸ‰ Isto foi anunciado neste comunicado.

Caso vocÃª queira simular o comportamento da aula, basta instalar o mÃ³dulo na versÃ£o 2.8.8 da seguinte forma:

```
npm install prettier@2.8.8
```

## Dia 11

### ğŸš— Pista RÃ¡pida

O Dia 11 ficou reservado para falar sobre DNS e a maravilha que Ã© esse negÃ³cio que inventaram e nesta Pista RÃ¡pida nÃ³s iremos revisar tudo o que aconteceu nas Pistas Lentas, com um adicional sobre ataques DDoS que tentaram derrubar a resoluÃ§Ã£o global de DNS ğŸ’ª

### ResoluÃ§Ã£o de DNS (Desafio NÃ­vel 1)

No momento que vocÃª entender de verdade o que Ã© DNS, vocÃª vai domar a principal porta de entrada pro seu site ou serviÃ§o, vocÃª vai reagir com frieza quando precisar mover a instalaÃ§Ã£o da sua aplicaÃ§Ã£o de um servidor para o outro ou pra quando quando precisar colocar um Cloudflare na frente para aguentar ataques de negaÃ§Ã£o (DoS e DDoS) que estÃ£o tentando derrubar o seu sistema.

Fora que vocÃª vai conseguir adicionar certas informaÃ§Ãµes dentro do seu domÃ­nio que vÃ£o certificar que vocÃª Ã© dono dele e que vÃ£o atÃ© aumentar a taxa de entrega dos emails que a sua aplicaÃ§Ã£o envia, por exemplo, emails de ativaÃ§Ã£o de cadastro ou recuperaÃ§Ã£o de senha, onde se vocÃª errar nisso, alguns provedores vÃ£o recusar por completo os emails enviados pela sua aplicaÃ§Ã£o... entÃ£o o assunto Ã© sÃ©rio.

E para ensinar DNS de um jeito diferente, optei por dividir o conhecimento em um Desafio de 2 NÃ­veis, onde este Ã© o primeiro nÃ­vel ğŸ’ª

> **ViniciusPimenta**

- `Root Server (Servidor Raiz)`: Os servidores raiz sÃ£o um conjunto de servidores DNS essenciais que estÃ£o localizados no topo da hierarquia do sistema de nomes de domÃ­nio. Eles sÃ£o responsÃ¡veis por responder Ã s consultas DNS de alto nÃ­vel, como "onde estÃ¡ o servidor para o domÃ­nio .com?" ou "onde estÃ¡ o servidor para o domÃ­nio .br?". Embora haja vÃ¡rias instÃ¢ncias de servidores raiz fÃ­sicos, eles sÃ£o representados por um pequeno nÃºmero de endereÃ§os IP, conhecidos como os "endereÃ§os IP dos servidores raiz". Esses servidores raiz nÃ£o resolvem consultas DNS completas, mas encaminham as consultas para os prÃ³ximos nÃ­veis da hierarquia.

- `TLD (Top-Level Domain - DomÃ­nio de Primeiro NÃ­vel)`: Os TLDs sÃ£o os segmentos finais dos nomes de domÃ­nio, como .com, .org, .net, .br, .edu, etc. Cada TLD Ã© administrado por uma organizaÃ§Ã£o ou entidade especÃ­fica, conhecida como Registro de TLD. Os servidores de nomes autoritativos para um TLD sÃ£o responsÃ¡veis por manter as informaÃ§Ãµes sobre os domÃ­nios registrados sob esse TLD. Por exemplo, os servidores de nomes autoritativos para o TLD .com sabem onde encontrar informaÃ§Ãµes sobre os domÃ­nios como exemplo.com, empresa.com, etc.

- `Authoritative Server (Servidor Autoritativo)`: Esses servidores contÃªm informaÃ§Ãµes especÃ­ficas sobre os domÃ­nios. Eles respondem a consultas DNS com informaÃ§Ãµes precisas e atualizadas para os domÃ­nios que gerenciam. Por exemplo, se alguÃ©m faz uma consulta sobre um nome de domÃ­nio especÃ­fico (por exemplo, www.exemplo.com), o servidor autoritativo para o domÃ­nio exemplo.com fornecerÃ¡ a resposta correta, como o endereÃ§o IP associado a esse domÃ­nio.

- `Recursive Resolver (Resolvedor Recursivo - Provedor de Internet)`: Esses sÃ£o os servidores DNS operados por provedores de internet (ISPs) ou outros provedores de serviÃ§os. Quando vocÃª faz uma consulta DNS, como digitar um nome de domÃ­nio no seu navegador, o resolvedor recursivo Ã© responsÃ¡vel por encontrar a resposta correta. Ele comeÃ§a perguntando aos servidores raiz sobre a localizaÃ§Ã£o dos servidores de nomes autoritativos para o TLD correspondente. Em seguida, consulta os servidores de nomes autoritativos para obter as informaÃ§Ãµes especÃ­ficas do domÃ­nio. Uma vez obtida a resposta, o resolvedor recursivo a armazena em cache para consultas futuras, reduzindo a latÃªncia.

Em resumo, os servidores raiz sÃ£o o ponto de partida para consultas DNS, os TLDs representam as diferentes categorias de domÃ­nios, os servidores autoritativos tÃªm informaÃ§Ãµes especÃ­ficas de domÃ­nio e os resolvedores recursivos sÃ£o responsÃ¡veis por encontrar e armazenar em cache as informaÃ§Ãµes de domÃ­nio para os usuÃ¡rios.

---

### VocÃª conseguiu encontrar o link secreto!

[Abra o BaÃº Para o PrÃ³ximo Desafio!](https://curso.dev/web/resolucao-dns-nivel-3)

### ResoluÃ§Ã£o de DNS (Desafio NÃ­vel 2)

Nesta aula iremos passar por toda cadeia de resoluÃ§Ã£o de um DNS e entender de fato como que atravÃ©s de um domÃ­nio Ã© possÃ­vel descobrir o IP do servidor ğŸ’ª

> **augustoresende**

Pra quem quiser aprofundar no assunto recomendo esse vÃ­deo do Ayub onde mostra que a noÃ§Ã£o de "propagaÃ§Ã£o de DNS" na realidade nÃ£o existe e que tudo Ã© TTL, e como ele funciona a fundo: https://www.youtube.com/watch?v=mJg47WRfrBw

---

## Dia 12

### ğŸš— Pista RÃ¡pida

Se o Dia 11 ficou reservado para falar da parte teÃ³rica do DNS, o Dia 12 ficou reservado para a parte prÃ¡tica e dentro deste vÃ­deo vamos revisar tudo o que aconteceu e, ao final, eu falo sobre uma caracterÃ­stica que os melhores profissionais com que eu jÃ¡ trabalhei compartilhavam ğŸ’ª

### Registrar um DomÃ­nio PrÃ³prio

Quando vocÃª faz um registro de um domÃ­nio .com.br (ou o registro de qualquer domÃ­nio na verdade), vocÃª estÃ¡ modificando a internet e Ã© isto que iremos fazer nesta aula ğŸ’ª

ğŸ›‘ **AtenÃ§Ã£o**

Caso ao registrar o domÃ­nio vocÃª receba uma mensagem de erro informando algo como "outro serviÃ§o estÃ¡ como responsÃ¡vel pela administraÃ§Ã£o", peÃ§o que leia as instruÃ§Ãµes colocadas neste [comentÃ¡rio do niege](https://curso.dev/alunos/niege/2cfc6796-1d2a-4895-8b3f-ca829f41563b) e que dÃ¡ os passos sobre como desbloquear o atual Registrador ğŸ¤

### Configurar o Servidor de DNS

Nesta Pista Lenta iremos configurar nosso prÃ³prio Servidor Autoritativo (Servidor de DNS), para que ele aponte lÃ¡ para o Servidor da Vercel, que Ã© onde ta o nosso site ğŸ’ª

**Chorinho sobre Servidor de DNS**

[Clique aqui](https://curso.dev/web/configurar-servidor-dns-chorinho) para acessar a aula ğŸ¤

Registro.br possui um "Modo AvanÃ§ado"
Eu nÃ£o sabia, mas o Rodrigo Kulb colocou [nesta resposta](https://curso.dev/alunos/niege/2cfc6796-1d2a-4895-8b3f-ca829f41563b) que o Registro.br possui um Modo AvanÃ§ado onde ele fornece para vocÃª um Servidor Autoritativo completo ğŸ˜

### "Chorinho" sobre Servidor de DNS ğŸ’ª

Que massa que vocÃª decidiu assistir o chorinho de conteÃºdo sobre o Servidor de DNS porque com ele hÃ¡ uma alta probabilidade de isso te colocar na frente daquele seniorzÃ£o do trabalho ou estar melhor preparado pra uma discussÃ£o na internet quando o assunto Ã© DNS ğŸ’ª

E nÃ£o perde a oportunidade de ficar atÃ© ao final para o desafio de Capture The Flag ğŸ¤

#### Let's code

Instale ferramentas de `DNS`

```
sudo apt install dnsutils
```

Exemplo:

```
dig fintab.com.br

;; ANSWER SECTION:
fintab.com.br.          0       IN      A       76.76.21.142
fintab.com.br.          0       IN      A       76.76.21.9
```

```
dig fintab.com.br TXT

;; ANSWER SECTION:
fintab.com.br.          0       IN      TXT     "Sou apaixonado pelos alunos do curso.dev"
```

```
dig fintab.com.br TXT +trace

; <<>> DiG 9.16.1-Ubuntu <<>> fintab.com.br TXT +trace
;; global options: +cmd
.                       0       IN      NS      a.root-servers.net.
.                       0       IN      NS      b.root-servers.net.
.                       0       IN      NS      c.root-servers.net.
.                       0       IN      NS      d.root-servers.net.
.                       0       IN      NS      e.root-servers.net.
.                       0       IN      NS      f.root-servers.net.
.                       0       IN      NS      g.root-servers.net.
.                       0       IN      NS      h.root-servers.net.
.                       0       IN      NS      i.root-servers.net.
.                       0       IN      NS      j.root-servers.net.
.                       0       IN      NS      k.root-servers.net.
.                       0       IN      NS      l.root-servers.net.
.                       0       IN      NS      m.root-servers.net.
;; Received 432 bytes from 172.29.240.1#53(172.29.240.1) in 0 ms

br.                     172800  IN      NS      a.dns.br.
br.                     172800  IN      NS      b.dns.br.
br.                     172800  IN      NS      c.dns.br.
br.                     172800  IN      NS      d.dns.br.
br.                     172800  IN      NS      e.dns.br.
br.                     172800  IN      NS      f.dns.br.
br.                     86400   IN      DS      38298 13 2 9F2D4993F47B0F2751DE0007D70A2754EE532FE373761154D9EA7A8C B9D8EA18
br.                     86400   IN      RRSIG   DS 8 1 86400 20240417190000 20240404180000 5613 . HMQfRu1BxWDQUtw2/ZTFKrOEbDTuH/JyUNHBavJ1syea2Vz6VJiz8iwX Bhbsw+uyXgTfkDjFpgYXqysDmXCbRmDsaij90TUsTGlyQ+zTh3EEV8+z rNhW+aCE1HR3iWHBMSwVZxVNRKUAwP7JDNyh1WZBw/UlUjFtJg8wrYuE ht0BkNE9HCSVRnZLEZI9SK9+FvKCgcH7y6y58SJ7FJNegEZSYM8zZ1O8 fREa7Pe8SFPODmfscl/7GlWKxDKnK2ZiZKk2KRaXjkYlWKNXaMTm900k yyelPJFRZjCZbnPBy2sI/w3uXSIuTH/sbFbvxeIrX6O9jRHABO4j1Vow y4H6bw==
;; Received 741 bytes from 199.7.91.13#53(d.root-servers.net) in 149 ms

fintab.com.br.          3600    IN      NS      ns1.vercel-dns.com.
fintab.com.br.          3600    IN      NS      ns2.vercel-dns.com.
ve8nh0hp4ithvld6q1usbiuo0f09ia67.com.br. 900 IN NSEC3 1 1 0 ECDCFACEFB1D98A53E0B VE8NNBTS3UKVO5V9J4VAF6NF8Q2S8IT4 NS SOA RRSIG DNSKEY NSEC3PARAM
ve8nh0hp4ithvld6q1usbiuo0f09ia67.com.br. 900 IN RRSIG NSEC3 13 3 900 20240419003508 20240404233508 57034 com.br. JODKAXt8fekFVTNScU1B09APnn1PGQ929rba58u6UmXuFtzY8NYXcAEU FaSWieGysoTIhjqZl6SAPWIVv2zysQ==
3at2plohqp8paoe4umtmbk3bu10t4d15.com.br. 900 IN NSEC3 1 1 0 ECDCFACEFB1D98A53E0B 3AT55RB38OM7ELJ4LKPLAJ6OB9QM43D2 NS DS RRSIG
3at2plohqp8paoe4umtmbk3bu10t4d15.com.br. 900 IN RRSIG NSEC3 13 3 900 20240416205608 20240402195608 57034 com.br. e4y+xbhaR2OmzreZHj3WkOqLudAjHyjSEUv/F5Hqkp8BABbqnYTByndW MLC6TIeR+MmwCCRRAZHIWginU68oLw==
;; Received 503 bytes from 200.189.41.10#53(b.dns.br) in 69 ms

fintab.com.br.          60      IN      TXT     "Sou apaixonado pelos alunos do curso.dev"
;; Received 95 bytes from 198.51.44.13#53(ns1.vercel-dns.com) in 39 ms
```

#### Desafio

```
dig curso.dev TXT

;; ANSWER SECTION:
curso.dev.              0       IN      TXT     "HA! Voce me encontrou, mas o desafio ainda nao terminou, a bandeira esta aqui: aHR0cHM6Ly9jdXJzby5kZXYvd2ViL2Rucy1oNGNrM3I="
curso.dev.              0       IN      TXT     "v=spf1 include:_spf.google.com ~all"
```

**Eu**:

pode converter o subdomÃ­nio em base64 "aHR0cHM6Ly9jdXJzby5kZXYvd2ViL2Rucy1oNGNrM3I="

**Copilot**:

Claro! O texto em base64 que vocÃª forneceu Ã©: "aHR0cHM6Ly9jdXJzby5kZXYvd2ViL2Rucy1oNGNrM3I=".
Vamos decodificÃ¡-lo para obter o URL original. Utilizando uma ferramenta de decodificaÃ§Ã£o de base64, obtemos:

- Acesse [esta ferramenta de decodificaÃ§Ã£o de base64](https://www.base64encode.org/).
- Cole o texto base64 na caixa de entrada.
- Clique no botÃ£o "Decode".
  O resultado Ã© o seguinte URL: https://curso.dev/web/dns-h4ck3r

### ğŸ³ï¸ Capture The Flag: DNS

VocÃª conseguiu encontrar a bandeira de DNS! ğŸ‰ ğŸ‰ ğŸ‰ ParabÃ©ns por ter concluÃ­do o primeiro Capture The Flag do curso.dev! ğŸ’ª ğŸ˜ ğŸ¤

## Dia 13

### ğŸš— Pista RÃ¡pida

Diferente da Pista RÃ¡pida do Dia 12 que foi bem longa, esta Pista RÃ¡pida aqui vai ser bem curta e rÃ¡pida mesmo, nÃ£o porque nÃ£o tem conhecimentos importantes nas duas Pistas Lentas do dia, porque tem sim, mas Ã© aquele tipo de conhecimento especial que revive acontecimentos da vida real de quem trabalha com tecnologia e que sÃ³ vai fazer sentido acompanhar pela Pista Lenta mesmo... mas vou resumir o que aconteceu ğŸ¤

### PÃ¡gina "Em ConstruÃ§Ã£o" e Encerramento da Milestone 0

Chegamos no ponto de comeÃ§ar a expandir o nosso alcance e comeÃ§ar a encontrar mais pessoas para criar um impacto e ter uma reaÃ§Ã£o delas. Como se a gente fosse um radar e comeÃ§asse a aumentar a potÃªncia dele, aumentar a potÃªncia do que vocÃª acredita que deva ser melhorado no mundo, aqueles 0.0000000000001% e aÃ­ vocÃª vai ver que mais pontinhos vÃ£o comeÃ§ar a aparecer no radar ğŸ’ª

Em paralelo a isto, eu apresento a Ideia McDonalds e mostro como eu usei ela para destravar o desenvolvimento de times em situaÃ§Ãµes da vida real e tambÃ©m para conseguir destravar as minhas prÃ³prias ideias ğŸ¤

**Museu TabNews**

- PÃ¡gina do Museu: https://www.tabnews.com.br/museu
- PÃ¡gina "Em ConstruÃ§Ã£o": https://www.tabnews.com.br/museu/construction-01.html

### NÃ£o confie em nenhum serviÃ§o ğŸ›‘

Quando eu falo para nÃ£o confiar nos serviÃ§os eu nÃ£o estou falando no sentido moral em que eles "querem o seu mal" ou "querem fraudar vocÃª" de alguma forma. AtÃ© porque, todos os serviÃ§os que eu uso (seja em projetos pessoais ou projetos profissionais) eu confio bastante neste ponto... e Ã© o mÃ­nimo na verdade.

Agora, uma coisa que vocÃª nÃ£o pode confiar e que nÃ£o existe, Ã© 100% de Uptime, ou seja, um serviÃ§o consiga dentro de um ano ficar online 100% do tempo nos mais de 31 milhÃµes de segundos que um ano tem.

**Status Pages**

- Vercel: https://www.vercel-status.com/
- AWS: https://health.aws.amazon.com/health/status
- GitHub: https://www.githubstatus.com/

## Dia 14

### ğŸš— Pista RÃ¡pida

O Dia 14 veio para inaugurar a Milestone 1: FundaÃ§Ã£o que Ã© um grande marco para o projeto e que vai fazer vocÃª entender como subir um projeto que pÃ¡ra em pÃ©, de forma organizada e, mais importante, sem endoidar e sem desistir no meio do caminho ğŸ’ª

**Aula nÃ£o listada extra**:

ğŸ BÃ´nus: [PoC e MVP ajudam mesmo?](https://curso.dev/web/poc-e-mvp)

### ğŸ BÃ´nus: PoC e MVP ajudam mesmo?

Que massa que vocÃª acessou a aula bÃ´nus e nela vamos conversar sobre uma confusÃ£o relacionada aos termos PoC e MVP ğŸ¤

### InauguraÃ§Ã£o Milestone 1: FundaÃ§Ã£o

Se vocÃª ficou feliz com os conhecimentos adquiridos atÃ© a conclusÃ£o da Milestone 0, vocÃª vai gostar muito mais dos conhecimentos que vai adquirir agora na Milestone 1: FundaÃ§Ã£o.

O nÃ­vel de seguranÃ§a e liberdade que vocÃª vai sentir ao concluir ela Ã© de um valor impagÃ¡vel! Chega de ter ideias que ficam paradas na gaveta, pois vocÃª vai ver uma oportunidade no mundo e vai ter capacidade de capturar ela ğŸ’ª

### Uma histÃ³ria macabra sobre "Overengineering"

Esta Ã© mais uma aula que vai trazer experiÃªncia da vida real e que eu tento passar um pouco da minha "imunidade tecnolÃ³gica" para vocÃª no que trata de algo que pode matar o seu projeto, o temido e confuso Overengineering.

Proposta de Arquitetura e Pastas
Chegou a hora de defirmos duas coisas importantes para o projeto:

### Arquitetura de Software

OrganizaÃ§Ã£o de Pastas e Arquivos
EntÃ£o neste vÃ­deo eu conto como foi o processo de decidir isso e outras coisas quando o TabNews nem existia ainda ğŸ¤

**Link da issue original**

Este Ã© o link da issue lÃ¡ do repositÃ³rio do TabNews:
https://github.com/filipedeschamps/tabnews.com.br/issues/12

> **eukaio**

Quem quiser inserir os emojis de pastas ğŸ“‚ e arquivos ğŸ“ƒ no texto da Issue basta ir em https://emojipedia.org/ e copiar.

JÃ¡ os caminhos das pastas foram desenhados com caracteres especiais para desenho de linha â”£ â”ƒ â”—. VocÃª encontra uma lista aqui https://en.wikipedia.org/wiki/Box-drawing_character

Edit: Para usuÃ¡rios de Windows existe o atalho tecla windows + tecla ponto (win + .) que abre uma lista de emojis.

---

## Dia 15

### ğŸš— Pista RÃ¡pida

Eu nÃ£o to brincando quando eu falo que o Dia 15 pode mudar de verdade a sua vida na programaÃ§Ã£o, isso porque ela ficou reservada para falar sobre Testes Automatizados e que Ã© um tema que, se vocÃª engata, se vocÃª entende os benefÃ­cios e usa pra programar de uma forma melhor e mais despreocupada, muda completamente o seu fluxo de trabalho e Ã© um caminho sem volta... sem volta mesmo!

### Testes Automatizados: um caminho sem volta

Trabalhar com Testes Automatizados para acelerar e melhorar como vocÃª programa Ã© um caminho sem volta. O problema Ã© como passar um conteÃºdo infinito como este num estilo "curso.dev" e neste vÃ­deo eu faÃ§o uma proposta ğŸ¤

### Instalar um Test Runner

Se vocÃª ainda nÃ£o passou pela jornada dos Testes Automatizados, com o que eu vou te mostrar daqui para frente, provavelmente vocÃª vai pensar "nossa... testes automatizados Ã© sÃ³ isso!?!" ... aÃ­ naturalmente vocÃª vai enfiando cada vez mais o pÃ© na lama, talvez num ponto de comeÃ§ar a colocar o assunto Testes Automatizados num pedestal. AÃ­ depois quando dÃ¡ aquele click de novo sobre o que realmente estÃ¡ acontecendo... vocÃª vai voltar a pensar: "nossaâ€¦ testes automatizadosâ€¦ Ã© sÃ³ isso?!??!?"

Ã‰ uma jornada muito legal e reveladora de vÃ¡rios aspectos sobre a "arte de programar", e tudo comeÃ§a com a instalaÃ§Ã£o de um Test Runner ğŸ’ª

#### Let's code

Instale o _test runner_ `jest`:

```
npm i -D jest@29.6.2
```

adicione os scripts de teste:

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch"
  }
}
```

### Criar um "Teste de Teste"

Eu e vocÃª temos uma missÃ£o importante dentro dessa aula que Ã© completar a tarefa de Criar um Teste de Teste, fora comeÃ§ar a aprender sobre o fluxo de trabalho que eu uso, que Ã© usar o Test Runner para que ele nos diga se estamos nos aproximando ou afastando de um certo objetivo. E se vocÃª estiver se perguntando: "mas tÃ¡... qual objetivo?" Ã“timo, porque Ã© exatamente aqui que vocÃª precisa ativar o seu Modo Arqueiro e todo arqueiro precisa de um alvo (de um objetivo) para atirar a sua flecha ğŸ¹

IntroduÃ§Ã£o ao JavaScript
Meu objetivo Ã© construir um material para pessoas que estÃ£o iniciando realmente do zero, mas enquanto este material nÃ£o existe, gostaria de recomendar a playlist abaixo:

ğŸ¥ [Curso GrÃ¡tis de JavaScript e ECMAScript para Iniciantes](https://www.youtube.com/playlist?list=PLHz_AreHm4dlsK3Nr9GVvXCbpQyHQl1o1)

### Criar um "Teste de Verdade"

Agora a coisa comeÃ§a a ficar sÃ©ria porque a gente vai criar um Teste de Verdade e encerrar a issue Testes Automatizados pra valer ğŸ’ª Fora isso, nÃ³s vamos treinar duas abordagens completamente opostas quando se escreve testes (onde uma Ã© sÃ³ para profissionais) ğŸ¤

## Dia 16

### ğŸš— Pista RÃ¡pida

O Dia 16 Ã© mais um daqueles dias especiais aqui no curso.dev porque mistura parte teÃ³rica, parte prÃ¡tica e tambÃ©m como ser um profissional melhor. E eu diria que esta Ãºltima parte de ser um profissional melhor Ã© o que faz grudar na sua mente a parte teÃ³rica e prÃ¡tica, tanto que no final dessa Pista RÃ¡pida aqui eu adicionei uma mensagem extra que eu nÃ£o coloquei em nenhuma Pista Lenta ğŸ’ª

### A maior briga no universo dos Testes Automatizados

Testes Automatizados Ã© um assunto tÃ£o importante quanto ele Ã© passÃ­vel de gerar briga na internet e nessa aula eu vou mostrar o motivo. Ã‰ muito importante vocÃª estar preparado para esse tipo de discussÃ£o, principalmente sobre a diferenÃ§a entre testes unitÃ¡rios, integraÃ§Ã£o e e2e ğŸ’ª

**Pergunta**

Qual a sua definiÃ§Ã£o sobre os tipos de teste que existem?

### Encostando a mÃ£o no Protocolo HTTP ğŸ”¥

Essa aula vai ser muito massa, porque eu e vocÃª vamos encostar a mÃ£o no protocolo HTTP e isso nÃ£o somente vai esclarecer na sua mente muita coisa sobre tudo o que existe na internet, como tambÃ©m vai ser a base para conseguir entender de fato (ou revisitar) muita coisa importante como: cookies, cabeÃ§alhos, status codes, mas tirando toda a magia de onde esses dados vem, e tudo isso vai colocar vocÃª um passo mais prÃ³ximo da senioridade, ou pelo menos, vai fazer vocÃª conseguir ter conversas sÃ©rias, muito mais avanÃ§adas e certeiras quando o contexto pedir por uma pessoa que tenha maturidade e experiÃªncia nesse assunto.

### NÃ£o Ã© magia! (Ã© Protocolo)

Eu sugiro vocÃª ter um Ãºnico objetivo com estas aulas mais recentes, que Ã© acreditar que, na area de tecnologia ou na programaÃ§Ã£o num geral, nÃ£o existe magia... nÃ£o existe mesmo! Toda informaÃ§Ã£o estÃ¡ em algum lugar e vocÃª pode nÃ£o conhecer esse lugar e naturalmente assumir que Ã© um local mÃ¡gico, mas nÃ£o Ã©.

EntÃ£o nesta aula nÃ³s iremos cavucar um pouco mais o Protocolo HTTP na procura de informaÃ§Ãµes que muitas pessoas encaram como "mÃ¡gicas" ğŸ’ª

### Versionamento de API e Endpoint "/status"

A aula de hoje tem muito mais conteÃºdos sobre API e HTTP, mas ela um objetivo muito claro e que jÃ¡ estÃ¡ super encaminhado, que Ã© completar a tarefa Criar endpoint /status, e em cima disto iremos aprender sobre Versionamento de API e Breaking Changes ğŸ¤

#### Let's code

| ObservaÃ§Ã£o
|:------------|
O curso nÃ£o utiliza `TypeScript`, dessa forma, vou mostrar algumas configuraÃ§Ãµes que utilizo nos meus projetos pessoais

Devido a compatibilidade entre as bibliotecas, atualize todas as dependÃªncias do projeto que foram instaladas numa versÃ£o especÃ­fica:

```
npm i next react react-dom
```

Instale o `git-commit-msg-linter`:

```
npm i -D git-commit-msg-linter
```

Instale e configure o suporte ao `TypeScript`:

```
npm i -D typescript @types/node @types/react @types/react-dom
```

crie o arquivos:

`tsconfig.json`

```json
{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
```

`next-env.d.ts`

```ts
/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/basic-features/typescript for more information.
```

`next.config.mjs`

```js
/** @type {import('next').NextConfig} */
const nextConfig = {}

export default nextConfig
```

TambÃ©m foi alterado a estrutura de pÃ¡ginas para utilizar o [App Router](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts), para isso renomeie a pasta `pages` para `app` e o arquivo `index.js` para `page.tsx`:

```tsx
const Home = () => <h1>Home</h1>

export default Home
```

criei o arquivo `layout.tsx`:

```tsx
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Clone TabNews',
  description:
    'ImplementaÃ§Ã£o do https://www.tabnews.com.br para o https://curso.dev'
}

export default function RootLayout({
  children
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="pt-br">
      <body className={inter.className}>{children}</body>
    </html>
  )
}
```

Instale bibliotecas de testes:

```
npm i -D jest @types/jest jest-environment-jsdom @testing-library/react @testing-library/jest-dom @testing-library/user-event cross-fetch
```

crie o arquivo `jest.setup.ts`:

```ts
import '@testing-library/jest-dom'
import 'cross-fetch/polyfill'
```

crie o arquivo `jest.config.js`

```js
module.exports = {
  clearMocks: true,
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.ts'],
  modulePaths: ['<rootDir>/src/'],
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': ['babel-jest', { presets: ['next/babel'] }]
  },
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/src/$1'
  }
}
```

crie a primeira rota da `api` em `src/app/api/v1/status/route.ts`:

```ts
import { NextResponse } from 'next/server'

export const GET = async () => {
  return NextResponse.json(
    { message: 'Esta Ã© uma mensagem de resposta' },
    {
      status: 200
    }
  )
}
```

FaÃ§a uma requisiÃ§Ã£o a `api`com o `curl` passando o parÃ¢metro `-v` para obter as informaÃ§Ãµes do protocolo `HTTP`:

```
curl http://localhost:3000/api/status -v
```

crie os testes automatizados:

`src/tests/integration/api/v1/status/get.test.ts`

```ts
describe('GET to /api/v1/status', () => {
  test('should return 200', async () => {
    const response = await fetch('http://localhost:3000/api/v1/status')
    expect(response.status).toBe(200)
  })
})
```

`src/tests/interface/app/home.test.tsx`:

```tsx
import { render, screen } from '@testing-library/react'
import Home from '@/app/page'

describe('<Home />', () => {
  test('should render the heading', () => {
    render(<Home />)
    expect(screen.getByRole('heading', { name: 'Home', level: 1 }))
  })
})
```

apÃ³s essas configuraÃ§Ãµes, resultou nos seguintes `scripts`:

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint:check": "prettier --check .",
    "lint:fix": "prettier --write .",
    "test": "jest",
    "test:watch": "jest --watch"
  }
}
```

## Dia 17

### ğŸš— Pista RÃ¡pida

AlÃ©m de conversarmos sobre tudo que foi feito no Dia 17, como as 3 partes que eu considero na escolha de um Banco de Dados, entender o motivo do Docker ter "dominado" o mundo das virtualizaÃ§Ãµes, depois como subir e se conectar a uma instÃ¢ncia de Postgres de forma local utilizando o Docker Compose, alÃ©m de tudo isso, eu passo mais um pouco da minha visÃ£o sobre o que faz um sÃªnior ser um sÃªnior na nossa Ã¡rea ğŸ’ª

### Qual Banco de Dados escolher?

Eu vou comeÃ§ar essa aula de um jeito estranho mas... e se eu te falar que talvez eu fiz a pior escolha de qual banco de dados usar para o TabNews e eu nÃ£o me arrependo nenhum pouco? ğŸ”¥

**Link para issue**

Segue abaixo o link para a issue que eu comentei no vÃ­deo:

https://github.com/filipedeschamps/tabnews.com.br/issues/61

### Por que o Docker dominou o mundo?

Eu vim de uma Ã©poca que me dÃ³i lembrar como que era configurar os serviÃ§os num ambiente de desenvolvimento local, porque toda hora algo mÃ¡gico acontecia ğŸ˜… E nesta Pista Lenta vamos conferir a evoluÃ§Ã£o deste assunto, atÃ© entrarmos na Ã©poca dos containers.

### Subir Banco de Dados (Local)

A aula de hoje vai ser bastante prÃ¡tica, pois iremos usar o docker compose para subir um Banco de Dados na sua versÃ£o Local ğŸ‰

### Se conectando no Banco de Dados (Local)

Eu deixei vocÃª na cara do gol na aula anterior, com o container rodando e servindo o Postgres, mas nÃ£o sendo possÃ­vel se conectar nele. E olha sÃ³ que engraÃ§ado, a aula de hoje vai comeÃ§ar tentando se conectar nele mesmo assim para entender de verdade porque nÃ£o Ã© possÃ­vel, e por fim, se conectar nele com sucesso ğŸ‰

## Dia 18

### ğŸš— Pista RÃ¡pida: Dia 18

Como sempre, vamos passar rapidamente pelas principais coisas que aconteceram no Dia 18 (e aconteceram muitas coisas), mas tem algo em especial que eu nÃ£o deixei claro em nenhuma Pista Lenta que eu quero falar aqui nessa Pista RÃ¡pida e que aconteceu 25 vezes ğŸ˜

### Criar mÃ³dulo "database.js"

Nesta aula iremos criar o mÃ³dulo database.js que Ã© uma abstraÃ§Ã£o da nossa infraestrutura e que vai ser responsÃ¡vel por abrir conexÃ£o com o Banco de Dados e enviar queries pra ele. Para isto, vamos instalar o mÃ³dulo pg na versÃ£o 8.11.3 ğŸ¤

**ComentÃ¡rio destaque** â­ï¸

Depois de ver a aula, sugiro ler [este comentÃ¡rio](https://curso.dev/alunos/filipedeschamps/ca07843d-c389-4722-83f7-55d8de12481b) que fiz sobre a dÃºvida de outro aluno, pois pode ajudar a clarear alguns pontos importantes sobre a utilidade do database.js ğŸ’ª

### A importÃ¢ncia das VariÃ¡veis de Ambiente

Quando eu realmente entendi o poder e a simplicidade das VariÃ¡veis de Ambiente, o meu cÃ©rebro deu alguns cliques muito importantes. Um deles foi de sempre que possÃ­vel deixar a camada da aplicaÃ§Ã£o stateless (sem estado) e isso se conecta perfeitamente com vÃ¡rias formas profissionais de se construir e escalar uma aplicaÃ§Ã£o ğŸ’ª

### VariÃ¡veis de Ambiente no CÃ³digo

Qual a relaÃ§Ã£o entre VariÃ¡veis de Ambiente, process, env e o que entra dentro do seu cÃ³digo? Vamos ver tudo isso dentro dessa aula e deixar sua aplicaÃ§Ã£o 100% stateless ğŸ’ª

### VariÃ¡veis de Ambiente no Docker Compose

Como fazer para evitar de ter VariÃ¡veis de Ambiente duplicadas no arquivo compose.yaml, no arquivo databse.js e fazer tudo puxar do .env? Ã‰ isso o que iremos ver nesta aula, fora se deparar com um mistÃ©rio... vamos ver se vocÃª sabe a resposta ğŸ¤

**MistÃ©rio: Por quÃª o Banco de Dados rodou?**

Por que no minuto 02:22 da aula, ao trocar a VariÃ¡vel de Ambiente de POSTGRES_DATABASE para POSTGRES_DB no arquivo .env, a conexÃ£o com o Banco de Dados continuou funcionando, se o database.js estava pedindo ainda pela antiga VariÃ¡vel de Ambiente POSTGRES_DATABASE? VocÃª vai precisar investigar para encontrar esta resposta ğŸ’ª

**ComentÃ¡rio em destaque**

Caso queira saber qual a resposta, sugiro ler [esse comentÃ¡rio](https://curso.dev/alunos/HenriqueNas/b907f191-6823-495b-84b3-bb9494c525c4) que estÃ¡ bastante completo ğŸ¤

#### Let's code

Instale o [node-postgres](https://www.npmjs.com/package/pg)

```
npm i pg
npm i -D @types/pg
```

crie o arquivo `.env.development`:

```
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=local_user
POSTGRES_DB=local_db
POSTGRES_PASSWORD=local_password
```

instale o `dotenv` e configure o arquivo `jest.config.js`:

```
npm i -D dotenv
```

```js
const nextJest = require('next/jest')
const dotenv = require('dotenv')

dotenv.config({
  path: '.env.development'
})

const createJestConfig = nextJest({
  dir: '.'
})

const jestConfig = createJestConfig({
  moduleDirectories: ['node_modules', '<rootDir>'],
  clearMocks: true,
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.ts'],
  modulePaths: ['<rootDir>/src/'],
  transform: {
    '^.+\\.(js|jsx|ts|tsx)$': ['babel-jest', { presets: ['next/babel'] }]
  },
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/src/$1'
  }
})

module.exports = jestConfig
```

adicione a configuraÃ§Ã£o do `Text Encoder` no arquivo `jest.setup.ts`:

```ts
import '@testing-library/jest-dom'
import 'cross-fetch/polyfill'
import { TextEncoder } from 'util'

global.TextEncoder = TextEncoder
```

crie a pasta `src/infra` e adicione os arquivos:

`compose.yml`

```yml
services:
  database:
    image: 'postgres:16.0-alpine3.18'
    env_file:
      - ../../.env.development
    ports:
      - '5432:5432'
```

`database.ts`

```ts
import { Client } from 'pg'

const getNewClient = async () => {
  const client = new Client({
    host: process.env.POSTGRES_HOST,
    port: process.env.POSTGRES_PORT as number | undefined,
    user: process.env.POSTGRES_USER,
    database: process.env.POSTGRES_DB,
    password: process.env.POSTGRES_PASSWORD
  })
  await client.connect()
  return client
}

const query = async (query: string, args?: string[]) => {
  let client
  try {
    client = await getNewClient()
    const result = await client.query(query, args)
    return result
  } catch (error) {
    console.error(error)
    throw error
  } finally {
    await client?.end()
  }
}

export const database = {
  query
}
```

altere o retorno da rota `/status`:

```ts
import { NextResponse } from 'next/server'
import { database } from '@/infra/database'

export const GET = async () => {
  const result = await database.query('SELECT 1 + 1;')
  return NextResponse.json(
    { message: result },
    {
      status: 200
    }
  )
}
```

e configure o teste:

```ts
import { database } from '@/infra/database'

describe('GET to /api/v1/status', () => {
  test('should return 200', async () => {
    const result = await database.query('SELECT 1 + 1;')
    const response = await fetch('http://localhost:3000/api/v1/status')
    expect(result).toBeDefined()
    expect(response.status).toBe(200)
  })
})
```

adicione os `scripts`:

```json
{
  "scripts": {
    "services:up": "docker compose -f src/infra/compose.yml up -d",
    "services:stop": "docker compose -f src/infra/compose.yml stop",
    "services:down": "docker compose -f src/infra/compose.yml down"
  }
}
```

execuÃ§Ã£o:

```
npm run services:up
npm run dev
npm run test:watch integration
```

caso deseje, instale o _client_ do `postgres` no sistema operacional:

```
sudo apt update
sudo apt install postgresql-client
```

execute o _client_:

```
psql --host=localhost --username=local_user --db=local_db --port=5432
```

| ObservaÃ§Ã£o
|:------------|
| ApÃ³s alterar o arquivo `compose.yml` Ã© necessÃ¡rio recriar a imagem, o que poder ser feito de duas formas: `docker compose down && docker compose up -d` ou `docker compose up -d --force-recreate`
| Para sair da conexÃ£o do `psql` basta digitar o comando `\q`

## Dia 19

### ğŸš— Pista RÃ¡pida

AlÃ©m de revisar tudo o que aconteceu no Dia 19, eu bato de novo na tecla do que Ã© algo ser semÃ¢ntico. Esta Ã© uma palavra que quero usar mais vezes, pois fazer coisas nÃ£o semÃ¢nticas inevitavelmente levam a muita confusÃ£o na evoluÃ§Ã£o de um sistema, principalmente quando o cÃ³digo Ã© passado de uma pessoa para outra ğŸ¤

### Foi certo fazer o commit do .env?

Como eu antecipei na Ãºltima Pista Lenta do Dia 18, algumas lapidaÃ§Ãµes importantes precisam ser feitas, incluindo em conhecimento, e eu acho melhor a gente nÃ£o deixar isso para depois e fazer agora. EntÃ£o eu gostaria de comeÃ§ar tocando no ponto de que se foi certo ou nÃ£o fazer o commit do arquivo .env ğŸ¤

**Artigo sobre remover dados sensÃ­veis**

Este Ã© o artigo que eu comentei sobre remover dados sensÃ­veis do histÃ³rico do seu repositÃ³rio: [Remover dados confidenciais de um repositÃ³rio](https://docs.github.com/pt/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository)

**ComentÃ¡rio em destaque**

Sugiro ler [esse comentÃ¡rio]() do aluno maion explicando como ele usou o BFG para remover dados sensÃ­veis de dois arquivos do seu repositÃ³rio ğŸ’ª

### Uma histÃ³ria macabra sobre "Choque ElÃ©trico" e "TDD"

Tem algo que me torra a paciÃªncia desde a criaÃ§Ã£o do Node.js que Ã© ele nÃ£o vir por padrÃ£o com um Root Path (Caminho Raiz ou DiretÃ³rio Raiz) do projeto, que Ã© saber por padrÃ£o onde estÃ¡ localizada a raiz dele para trabalhar com Absolute Imports e nÃ£o somente com Relative Imports. Existe uma forma bastante moderna de solucionar isso e para fazer esta implementaÃ§Ã£o no estilo curso.dev, eu preciso primeiro contar uma histÃ³ria sobre o Guga ter levado um choque por nÃ£o ter aplicado TDD ğŸ¤

### Configurar o "baseUrl" para "Absolute Imports"

Sem tempo a perder (e sem levar choque), nosso objetivo com essa aula Ã© matar o `../../../../` interminÃ¡vel para acessar o database.js e conseguir referenciar ele apenas como `infra/database.j`s em qualquer que seja o script que queira importÃ¡-lo ğŸ’ª

**ComentÃ¡rio em destaque**

Depois de ver a aula, sugiro ler [este comentÃ¡rio](https://curso.dev/alunos/marini/46f83768-86d5-4d80-b584-4ad9e780de14) sobre um comporamento muito interessante a respeito de iniciar o caminho com / ğŸ¤

### Configurar scripts dos serviÃ§os

Essa aqui vai ser mais uma aula com lapidaÃ§Ãµes, mas uma super importante, porque a gente vai deixar o projeto alinhado para quando a gente for trabalhar na issue de Continuous Integration ğŸ’ª Fora isso, a aula Ã© repleta com dicas extras ğŸ˜

#### Let's code

Baseado no comentÃ¡rio do [brunocmessias](https://curso.dev/web/configurar-scripts-servicos#:~:text=3-,brunocmessias,-28%20dias%20atr%C3%A1s), criei o script `init-dev.sh`:

```sh
#!/bin/bash

function cleanup {
  npm run services:down
  PID=$(lsof -t -i:3000)
  if [ -n "$PID" ]; then
    kill $PID
  fi
  exit 0
}

trap cleanup INT

npm run services:up && next dev
```

scripts no `package.json`:

```json
{
  "scripts": {
    "dev": "./init-dev.sh",
    "services:up": "docker compose -f src/infra/compose.yml up -d",
    "services:stop": "docker compose -f src/infra/compose.yml stop",
    "services:down": "docker compose -f src/infra/compose.yml down"
  }
}
```

## Dia 20

### ğŸš— Pista RÃ¡pida

Eu jÃ¡ trabalhei com muita gente boa, mas atÃ© essas pessoas (uma parte delas pelo menos), deixavam escapar algo extremamente importante... deixavam de pensar sobre algo importante na hora de programar um backend, mas vocÃª nÃ£o vai falhar nisso e Ã© por esse e outros motivos que o Dia 20 existe ğŸ’ª

### Endpoint "/status": ISO 8601 + Fuso + MVC + lowerCamelCase

Esta Ã© uma descriÃ§Ã£o difÃ­cil de se fazer, pois esta Ã© mais uma daquelas aulas onde eu avanÃ§o o projeto e utilizo qualquer oportunidade que consigo para fazer o download de mais conhecimentos. Por isso que alÃ©m de avanÃ§ar com o endpoint /status, eu aproveito para falar sobre ISO 8601, Fuso, MVC e lowerCamelCase ğŸ’ª

### Database "Version" (+ Red, Green e Refactor do TDD)

Chegou a hora de usar 100% de TDD para implementar o retorno do dependencies.database.version. Fora isso, vamos revisitar os 3 EstÃ¡gios do TDD que sÃ£o Red, Green e Refactor ğŸ’ª

ğŸ›‘ **AtenÃ§Ã£o**

Para vocÃª entender o comeÃ§o dessa aula, vocÃª precisa ficar atÃ© o Ãºltimo segundo da aula anterior: [Endpoint "/status": ISO 8601 + Fuso + MVC + lowerCamelCase](https://curso.dev/web/endpoint-status-updated-at) ğŸ¤

### Database "Max Connections"

JÃ¡ que estamos retornando a VersÃ£o do Postgres no endpoint /status, o prÃ³ximo agora passo Ã© retornar as ConexÃµes mÃ¡ximas e, tecnicamente falando, isso Ã© uma implementaÃ§Ã£o simples, mas vai ser a oportunidade perfeita pra que, no meio da implementaÃ§Ã£o, eu faÃ§a uma pergunta muito importante.. uma que evitaria eu ter cometido um erro no TabNews. Vamos ver qual vai ser a sua resposta ğŸ˜

### Database "Opened Connections"

Essa Pista Lenta aqui vai ser muito massa, porque ela vai abrir margem pra eu ensinar conceitos muito importantes sobre Banco de Dados, trÃ¡fego de dados, fora que a Ãºltima coisa que falta Ã© injetar no retorno do endpoint /status a quantidade de ConexÃµes usadas pelo nosso backend, na verdade... quantas conexÃµes ao banco estÃ£o abertas naquele momento, independente se foi nosso backend ou outro client que estÃ¡ se conectando ao banco ğŸ¤

### SQL Injection e Queries Parametrizadas

O Dia 20 tÃ¡ bem massa e vai ficar ainda mais, porque nesta Pista Lenta vamos aprender sobre SQL Injection, Queries Parametrizadas, identificar e consertar o problema de Vazamento de ConexÃµes, marcar como concluÃ­da a tarefa Finalizar retorno do endpoint /status e concluir a issue Banco de Dados (Local) com muito orgulho ğŸ’ª

#### Let's code

Pra quem deseja utlizar `TypeScript` no projeto, escrevi um [tutorial no TabNews](https://www.tabnews.com.br/diasjoaovitor/tutorial-como-criar-um-boilerplate-para-projetos-com-next-js) sobre como configurar um boilerplate para projetos `Next`.

Eu fiz algumas alteraÃ§Ãµes no projeto que estamos fazendo no curso e ele estÃ¡ estruturado da seguinte forma:

```
tree -a -I 'node_modules|.next|.swc|.git|assets|docs|_'
```

```
â”œâ”€â”€ .editorconfig
â”œâ”€â”€ .env.development
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .github
â”‚Â Â  â””â”€â”€ workflows
â”‚Â Â      â””â”€â”€ ci.yml
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .husky
â”‚Â Â  â””â”€â”€ pre-commit
â”œâ”€â”€ .lintstagedrc.js
â”œâ”€â”€ .nvmrc
â”œâ”€â”€ .prettierignore
â”œâ”€â”€ .prettierrc.json
â”œâ”€â”€ .vscode
â”‚Â Â  â””â”€â”€ settings.json
â”œâ”€â”€ README.md
â”œâ”€â”€ generators
â”‚Â Â  â”œâ”€â”€ plopfile.js
â”‚Â Â  â””â”€â”€ templates
â”‚Â Â      â””â”€â”€ index.tsx.hbs
â”œâ”€â”€ init-dev.sh
â”œâ”€â”€ jest.config.js
â”œâ”€â”€ jest.setup.ts
â”œâ”€â”€ next-env.d.ts
â”œâ”€â”€ next.config.mjs
â”œâ”€â”€ package.json
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ app
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ api
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ v1
â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ status
â”‚Â Â  â”‚Â Â  â”‚Â Â          â””â”€â”€ route.ts
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ layout.tsx
â”‚Â Â  â”‚Â Â  â””â”€â”€ page.tsx
â”‚Â Â  â”œâ”€â”€ infra
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ compose.yml
â”‚Â Â  â”‚Â Â  â””â”€â”€ database.ts
â”‚Â Â  â””â”€â”€ tests
â”‚Â Â      â”œâ”€â”€ integration
â”‚Â Â      â”‚Â Â  â””â”€â”€ api
â”‚Â Â      â”‚Â Â      â””â”€â”€ v1
â”‚Â Â      â”‚Â Â          â””â”€â”€ status
â”‚Â Â      â”‚Â Â              â””â”€â”€ get.test.ts
â”‚Â Â      â””â”€â”€ interface
â”‚Â Â          â””â”€â”€ app
â”‚Â Â              â””â”€â”€ home.test.tsx
â”œâ”€â”€ tsconfig.json
â””â”€â”€ package-lock.json
```

Estou usando `App Router` ao invÃ©s de `Pages Router`, entÃ£o a estrutura varia um pouco.

O arquivo `route.ts` ficou da seguinte forma:

```ts
import { NextResponse } from 'next/server'
import { QueryResult, QueryResultRow } from 'pg'
import { database } from '@/infra/database'

export type TStatusBody = {
  updated_at: string
  dependencies: {
    database: {
      version: string
      max_connections: string
      opened_connections: number
    }
  }
}

export const GET = async () => {
  const updatedAt = new Date().toISOString()

  const {
    rows: [{ server_version }]
  } = (await database.query(
    'show server_version;'
  )) as QueryResult<QueryResultRow>

  const {
    rows: [{ max_connections }]
  } = (await database.query(
    'show max_connections;'
  )) as QueryResult<QueryResultRow>

  const databaseName = process.env.POSTGRES_DB as string
  const {
    rows: [{ count }]
  } = (await database.query({
    text: 'select count(*)::int from pg_stat_activity where datname = $1;',
    values: [databaseName]
  })) as QueryResult<QueryResultRow>

  const body: TStatusBody = {
    updated_at: updatedAt,
    dependencies: {
      database: {
        version: server_version,
        max_connections,
        opened_connections: count
      }
    }
  }
  return NextResponse.json(body, {
    status: 200
  })
}
```

Arquivo `layout.tsx`:

```tsx
import type { Metadata } from 'next'
import { Inter } from 'next/font/google'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'Clone TabNews',
  description:
    'ImplementaÃ§Ã£o do https://www.tabnews.com.br para o https://curso.dev'
}

const RootLayout = ({
  children
}: Readonly<{
  children: React.ReactNode
}>) => {
  return (
    <html lang="pt-br">
      <body className={inter.className}>{children}</body>
    </html>
  )
}

export default RootLayout
```

Arquivo `page.tsx`:

```tsx
const Home = () => <h1>Home</h1>

export default Home
```

Arquivo `database.ts`:

```ts
import { Client } from 'pg'

const getNewClient = async () => {
  const client = new Client({
    host: process.env.POSTGRES_HOST,
    port: process.env.POSTGRES_PORT as number | undefined,
    user: process.env.POSTGRES_USER,
    database: process.env.POSTGRES_DB,
    password: process.env.POSTGRES_PASSWORD
  })
  await client.connect()
  return client
}

const query = async (
  query: string | { text: string; values: (number | string)[] },
  args?: string[]
) => {
  let client
  try {
    client = await getNewClient()
    const result = await client.query(query, args)
    return result
  } catch (error) {
    console.error(error)
    throw error
  } finally {
    await client?.end()
  }
}

export const database = {
  query
}
```

Arquivo `get.test.ts`:

```ts
import { TStatusBody } from '@/app/api/v1/status/route'

describe('GET to /api/v1/status', () => {
  test('should return 200', async () => {
    const response = await fetch('http://localhost:3000/api/v1/status')
    expect(response.status).toBe(200)

    const data: TStatusBody = await response.json()
    const { updated_at } = data

    const parsedUpdatedAt = new Date(updated_at).toISOString()
    expect(updated_at).toBe(parsedUpdatedAt)

    const expectedData: TStatusBody = {
      updated_at,
      dependencies: {
        database: {
          version: '16.0',
          max_connections: '100',
          opened_connections: 1
        }
      }
    }
    expect(data).toEqual(expectedData)
  })
})
```

Arquivo `home.test.tsx`:

```ts
import { render, screen } from '@testing-library/react'
import Home from '@/app/page'

describe('<Home />', () => {
  test('should render the heading', () => {
    render(<Home />)
    expect(screen.getByRole('heading', { name: 'Home', level: 1 }))
  })
})
```

## Dia 21

### ğŸš— Pista RÃ¡pida

O Dia 21 Ã© extremamente denso e pode ser um daqueles Dias em que vocÃª sai diferente do outro lado, ainda mais numa parte extremamente importante para maioria das aplicaÃ§Ãµes que Ã© o Banco de Dados.

**Cena final**

Os alunos que aparecem na cena final foram os que mais assistiram aulas atÃ© o momento em que este vÃ­deo foi produzido (incluindo aulas de Desafio, Capture The Flag e Easter Egg) ğŸ¤

### Investigando logs da Vercel em ProduÃ§Ã£o

NÃ£o tem coisa que me assusta mais em desenvolvimento de software do que ficar muito tempo sem fazer deploy em produÃ§Ã£o. E como o endpoint `/api/v1/status` estÃ¡ retornando erro 500, vamos aproveitar para investigar e provar o que estÃ¡ acontecendo ğŸ’ª

### Banco de ProduÃ§Ã£o no ElephantSQL (gratuito)

Temos uma missÃ£o muito importante que Ã©, nessa aula, criar uma conta no ElephantSQL, criar um banco Postgres lÃ¡ dentro, pegar as credenciais desse banco, configurar elas nas variÃ¡veis de ambiente lÃ¡ da Vercel e com isso fazer o endpoint /api/v1/status em produÃ§Ã£o voltar a vida ğŸ’ª

[Link da issue que comentei](https://github.com/filipedeschamps/tabnews.com.br/issues/120)

**Migrations nÃ£o estÃ£o mais sendo rodadas
AtenÃ§Ã£o** ğŸ›‘

De uma forma assustadora, alguns dias depois desta aula ter sido publicada, a ElephantSQL publicou em [seu blog](https://www.elephantsql.com/blog/end-of-life-announcement.html) que nÃ£o irÃ¡ mais aceitar novas contas a partir do dia 01/05/2024 e irÃ¡ encerrar suas atividades dia 27/01/2025.

Independente disto, a parte educacional da aula mantÃ©m 100% de validade ğŸ‰

### Banco de ProduÃ§Ã£o no Neon (gratuito)

A gente nÃ£o precisa inventar ou se preocupar com mais nada nesse momento a nÃ£o ser fazer tudo o que a gente fez com o ElephantSQL, mas agora com o Neon, que como falei na aula anterior, Ã© um serviÃ§o mais novo e com recursos mais sofisticados ğŸ’ª

#### Let's code

Adicione o valor abaixo no objeto de configuraÃ§Ã£o da funÃ§Ã£o `getNewClient`:

```js
ssl: process.env.NODE_ENV === 'production'
```

### Banco de ProduÃ§Ã£o no DigitalOcean (pago)

A nossa prÃ³xima tarefa Ã© criar uma conta na [DigitalOcean](https://www.digitalocean.com/) e levantar uma instÃ¢ncia lÃ¡ de Postgres ğŸ’ª SerÃ¡ que vai ser fÃ¡cil ou vai ter mais um conhecimento super importante "barrando" o nosso caminho? Spoiler: vai ter e vai ser MUITO massa ğŸ˜‰

#### ObservaÃ§Ã£o

Essa aula explica como configurar um serviÃ§o que necessita de certificado para funcionar e apresenta a criaÃ§Ã£o da funÃ§Ã£o [getSSLValues](https://github.com/filipedeschamps/clone-tabnews/blob/c5cc52442f9343e940a733a7542214b290e92a90/infra/database.js#L36), na qual nÃ£o Ã© necessÃ¡ria para o banco de dados `Neon`

## Dia 22

### ğŸš— Pista RÃ¡pida

NÃ£o existe profissional na nossa Ã¡rea, que se considera um profissional completo pelo menos, e que nÃ£o sabe mexer com migrations. EntÃ£o, se esta Ã© uma lacuna no seu conhecimento, fica tranquilo, que o Dia 22 veio para resolver isso de uma vez por todas ğŸ’ª

### Por que as Migrations existem?

Como a gente acabou de encostar no assunto Banco de Dados, o que vocÃª acha da gente matar o assunto Migrations que estÃ¡ super relacionado? E Ã© atÃ© importante tratar disso agora, no inÃ­cio, porque um projeto que nÃ£o usa Migrations para o seu Banco de Dados seria mais ou menos anÃ¡logo a um projeto que nÃ£o usa versionamento, Git, para o cÃ³digo do seu projeto para manter a integridade e rastreamento das alteraÃ§Ãµes.

### Migrations por Linha de Comando

Nesta Pista Lenta iremos dar passos concretos para se trabalhar com Migrations, onde atravÃ©s da CLI (Command Line Interface) do node-pg-migrate, iremos tanto criar arquivos de migraÃ§Ã£o quanto executar eles para valer ğŸ’ª

#### Let's code

Instale o `node-pg-migrate` e o `dotenv-expand`:

```
npm i -D node-pg-migrate dotenv-expand
```

Adicione a variÃ¡vel de ambiente `DATABASE_URL` no arquivo `.env.development`:

```
DATABASE_URL=postgres://$POSTGRES_USER:$POSTGRES_PASSWORD@$POSTGRES_HOST:$POSTGRES_PORT/$POSTGRES_DB
```

Adicione os `scripts`:

```json
{
  "scripts": {
    "migration:create": "node-pg-migrate -m src/infra/migrations create",
    "migration:up": "node-pg-migrate -m src/infra/migrations --envPath .env.development up"
  }
}
```

## Dia 23

### ğŸš— Pista RÃ¡pida

Se o Dia 22 abriu um pouco a sua mente sobre o assunto Migrations, o Dia 23 vai consolidar muita coisa, fora abrir margem pra gente conversar assuntos extremamente importantes e que vÃ£o influenciar todo o restante do desenvolvimento ğŸ¤

### Migrations pelo endpoint â€œ/migrationsâ€ (Dry Run)

Dessa vez vamos atacar a tarefona "Executar Migrations pelo endpoint /migrations" e continuando nesse ritmo, vai ser inevitÃ¡vel vocÃª se tornar um profissional nesse assunto ğŸ¤

### Por que evitar a direÃ§Ã£o "down"?

Do jeito que o cÃ³digo do /migrations estÃ¡ hoje, tanto se vocÃª rodar ele no modo Dry Run, quanto no Live Run, ambos vÃ£o executar as Migrations somente na mesma direÃ§Ã£o, a up, que Ã© ler e executar elas na ordem crescente. Isto nÃ£o vai mudar e nesta aula irei ter uma conversa muito importante com vocÃª dos motivos desta escolha ğŸ¤

**Artigos citados na aula**

- [Pitfalls with SQL rollbacks and automated database deployments](https://octopus.com/blog/database-rollbacks-pitfalls)
- [Stack Overflow: How We Do Deployment - 2016 Edition](https://nickcraver.com/blog/2016/05/03/stack-overflow-how-we-do-deployment-2016-edition/)

### Migrations pelo endpoint "/migrations" (Live Run - InÃ­cio)

Chegou a hora de implementarmos uma versÃ£o do cÃ³digo onde, ao realizar um POST contra o endpoint /api/v1/migrations, as Migrations do sistema sÃ£o rodadas para valer no modo Live Run, e tudo isso coberto por Testes Automatizados, onde inclusive vamos ver como filtrar os testes de uma forma mais refinada para conseguir isolar apenas a bateria de testes que queremos rodar e isto Ã© fundamental para quando a quantidade de testes for maior ğŸ’ª

Mas o mais importante desta aula Ã© revelar uma condiÃ§Ã£o na arquitetura dos testes que eu estipulei no comeÃ§o do TabNews ğŸ¤

**Artigos citados na aula**

- [The argument against clearing the database between tests](https://calpaterson.com/against-database-teardown.html)
- [Thread no Hacker News](https://news.ycombinator.com/item?id=29764792)

## Dia 24

### ğŸš— Pista RÃ¡pida

O Dia 24 faz parte de uma sÃ©rie de desafios que eu gostaria que vocÃª passasse para que uma grande liÃ§Ã£o faÃ§a sentido... algo que na minha visÃ£o vai deixar vocÃª Ã  prova de balas, ou atÃ© melhor, Ã  prova de futuro ğŸ’ª

### Fazendo o Jest "transpilar" arquivos em ESM

Ã‰ a partir dessa Pista Lenta que vocÃª vai entender o afastamento que dÃ¡ para ter da Muralha de NegÃ³cio que Ã©, no final das contas, ter o endpoint /migrations usÃ¡vel por quem quer consultar ou rodar as Migrations do sistema por essa interface programÃ¡tica. Eu digo isso, porque a gente vai passar por algumas coisas da Muralha TÃ©cnica que nÃ£o sÃ£o tÃ£o semÃ¢nticas, nem divertidas, pelo menos quando comparado a onde a gente quer chegar. Uma destas coisas Ã© fazer o Jest conseguir ler e utilizar mÃ³dulos ESM, que Ã© o que iremos resolver dentro desta aula ğŸ¤

**Desafios para prÃ³xima aula**

Ao final eu proponho dois desafios:

- Desafio NÃ­vel 1: provar atravÃ©s do cÃ³digo que o processo do Jest de fato estÃ¡ rodando no ambiente test e tambÃ©m provar que as credenciais do Banco de Dados nÃ£o estÃ£o sendo injetadas no process.env.
- Desafio NÃ­vel 2: fazer o .env.development ser carregado dentro do processo do Jest.

**Como publicar as respostas sem dar spoiler?**

Dentro do corpo da sua resposta, vocÃª pode pode utilizar a tag especial `<details>`, por exemplo:

````html
<details>
  <summary>Spoiler</summary>

  Esta parte estarÃ¡ escondida por padrÃ£o atÃ© que vocÃª clique em `Spoiler`. E
  aqui dentro vocÃª poderÃ¡ colocar o que quiser, atÃ© outro cÃ³digo, por exemplo:
  ``` js console.log('funcionou!'); ```
</details>
````

O resultado do cÃ³digo acima Ã© isto aqui:

<details>
  <summary>Spoiler</summary>

Esta parte estarÃ¡ escondida por padrÃ£o atÃ© que vocÃª clique em `Spoiler`.

E aqui dentro vocÃª poderÃ¡ colocar o que quiser, atÃ© outro cÃ³digo, por exemplo:

```js
console.log('funcionou!')
```

</details>

### Limpando o Banco de Dados

Vamos matar nessa aula o Desafio de NÃ­vel 1 e Desafio de NÃ­vel 2 para vocÃª tanto comparar como eu vou fazer por aqui, quanto pra treinar fazer esse tipo de investigaÃ§Ã£o e como abordar um problema como esse, porque essas habilidades vÃ£o valer por muito tempo ğŸ’ª E como resultado final, iremos limpar o state do Banco de Dados a cada bateria de teste ğŸ¤

### Expandindo testes e refatorando implementaÃ§Ã£o

Pelo fato de na aula anterior a gente ter conseguido estabilizar os testes - deixar eles reproduzÃ­veis independente de modificarem o state do banco ou nÃ£o - significa que agora Ã© possÃ­vel expandir eles, deixar eles mais sofisticados.

Dado a isso eu vou expandir o teste do POST para provar que o endpoint /migrations estÃ¡ fazendo o que ele deveria estar fazendo e tambÃ©m gostaria de aproveitar para fazer algumas refatoraÃ§Ãµes, incluindo introduzir comportamentos novos na implementaÃ§Ã£o concreta do endpoint ğŸ¤

## Dia 25

### ğŸš— Pista RÃ¡pida

O Dia 25 Ã© um dia muito legal, muito gostoso de se assistir, tanto porque a gente avanÃ§a a Milestone quanto porque ele contÃ©m uma grande liÃ§Ã£o e atÃ© um puxÃ£o de orelha. Fora isso, nesta Pista RÃ¡pida aqui, vocÃª irÃ¡ ver trechos de uma Live que eu fiz com os Membros do meu canal no YouTube em 2021, quando publicamos pela primeira vez o endpoint /api/v1/migrations em ProduÃ§Ã£o ğŸ¤

### Fazendo Deploy e rodando as Migrations em ProduÃ§Ã£o ğŸ‰

Nesta Pista Lenta iremos concluir a tarefa Executar Migrations pelo endpoint /migrations, fechar a Issue de Migrations e avanÃ§ar a Milestone ğŸ˜ Tudo isso, pois iremos fazer o deploy em produÃ§Ã£o do que implementamos nos Ãºltimos Dias ğŸ’ª

### Grande liÃ§Ã£o + PuxÃ£o de orelha ğŸ’ª

Vamos conversar de uma forma mais sÃ©ria hoje e numa das aulas do Dia 23 eu comentei que, na nossa Ã¡rea Ã© possÃ­vel seguir por dois caminhos, o caminho que outras pessoas estÃ£o seguindo e o caminho que vocÃª acabou de seguir... e agora eu gostaria de esclarecer mais o que sÃ£o esses dois caminhos ğŸ’ª

#### Let's code

`jest.config.js`

```js
const nextJest = require('next/jest')
const dotenv = require('dotenv')

dotenv.config({
  path: '.env.development'
})

const createJestConfig = nextJest({
  dir: '.'
})

const jestConfig = createJestConfig({
  testEnvironment: 'jsdom',
  setupFilesAfterEnv: ['<rootDir>/jest.setup.ts']
})

module.exports = jestConfig
```

---

`package.json`

```json
{
  {
    "scripts": {
      // ...,
      "test": "jest --runInBand",
      "test:watch": "jest --runInBand --watchAll"
    }
  }
 }
```

---

`migrations/route.ts`

```ts
import { NextResponse } from 'next/server'
import { ClientBase } from 'pg'
import migrationRunner, { RunnerOption } from 'node-pg-migrate'
import { join } from 'path'
import { database } from '@/infra/database'

const getDefaultMigrationOptions = ({
  dbClient,
  dryRun
}: {
  dbClient: ClientBase
  dryRun: boolean
}) => {
  const options: RunnerOption = {
    dir: join('src', 'infra', 'migrations'),
    direction: 'up',
    verbose: true,
    migrationsTable: 'pgmigrations',
    dbClient,
    dryRun
  }
  return options
}

export const GET = async () => {
  let dbClient
  try {
    dbClient = await database.getNewClient()
    const defaultMigrationOptions = getDefaultMigrationOptions({
      dbClient,
      dryRun: true
    })
    const pendingMigrations = await migrationRunner(defaultMigrationOptions)
    return NextResponse.json(pendingMigrations, {
      status: 200
    })
  } catch (error) {
    console.error(error)
    throw error
  } finally {
    await dbClient?.end()
  }
}

export const POST = async () => {
  let dbClient
  try {
    dbClient = await database.getNewClient()
    const defaultMigrationOptions = getDefaultMigrationOptions({
      dbClient,
      dryRun: false
    })
    const migratedMigrations = await migrationRunner(defaultMigrationOptions)
    const status = migratedMigrations.length > 0 ? 201 : 200
    return NextResponse.json(migratedMigrations, { status })
  } catch (error) {
    console.error(error)
    throw error
  } finally {
    await dbClient?.end()
  }
}
```

---

`database.ts`

```ts
import { Client } from 'pg'

const getNewClient = async () => {
  const client = new Client({
    host: process.env.POSTGRES_HOST,
    port: process.env.POSTGRES_PORT as number | undefined,
    user: process.env.POSTGRES_USER,
    database: process.env.POSTGRES_DB,
    password: process.env.POSTGRES_PASSWORD,
    ssl: process.env.NODE_ENV === 'production'
  })
  await client.connect()
  return client
}

const query = async (
  query: string | { text: string; values: (number | string)[] },
  args?: string[]
) => {
  let client
  try {
    client = await getNewClient()
    const result = await client.query(query, args)
    return result
  } catch (error) {
    console.error(error)
    throw error
  } finally {
    await client?.end()
  }
}

export const database = {
  query,
  getNewClient
}
```

---

`tests/orchestrator.ts`

```ts
import { database } from '@/infra/database'

export const cleanDatabase = async () => {
  await database.query('drop schema public cascade; create schema public;')
}
```

---

`get.test.ts`

```ts
import { cleanDatabase } from '@/tests/orchestrator'

describe('GET to /api/v1/migrations', () => {
  beforeAll(cleanDatabase)

  test('should return 200', async () => {
    const response = await fetch('http://localhost:3000/api/v1/migrations')
    expect(response.status).toBe(200)

    const responseBody = await response.json()

    expect(Array.isArray(responseBody)).toBe(true)
    expect(responseBody.length).toBeGreaterThan(0)
  })
})
```

---

`post.test.ts`

```ts
import { cleanDatabase } from '@/tests/orchestrator'

describe('POST to /api/v1/migrations', () => {
  beforeAll(cleanDatabase)

  test('should return 200', async () => {
    const response1 = await fetch('http://localhost:3000/api/v1/migrations', {
      method: 'POST'
    })
    expect(response1.status).toBe(201)

    const response1Body = await response1.json()
    expect(Array.isArray(response1Body)).toBe(true)
    expect(response1Body.length).toBeGreaterThan(0)

    const response2 = await fetch('http://localhost:3000/api/v1/migrations', {
      method: 'POST'
    })
    expect(response2.status).toBe(200)

    const response2Body = await response2.json()

    expect(Array.isArray(response2Body)).toBe(true)
    expect(response2Body.length).toBe(0)
  })
})
```

## Dia 26

### ğŸš— Pista RÃ¡pida

No Dia 26 vocÃª vai ver duas coisas muito importantes acontecendo na sua frente: o ambiente de HomologaÃ§Ã£o tomando forma e servindo pra debugar um problema real e o "EspÃ­rito Open Source" brotando por dentro dos comentÃ¡rios aqui na plataforma do curso.dev ğŸ˜

### Git Branch (3 nÃ­veis de compreensÃ£o)

Nesta aula vocÃª irÃ¡ aprender sobre um dos recursos mais importantes do Git na minha opiniÃ£o que se chama branches! E entender de branches pode ser a coisa mais simples do mundo ou mais complicada do mundo dependendo do modelo mental que vocÃª usar pra entender o que estÃ¡ acontecendo. Por conta disso eu gostaria de fazer 3 explicaÃ§Ãµes para vocÃª, que sÃ£o na verdade 3 nÃ­veis de compreensÃ£o sobre a feature de branches ğŸ¤

**Link para o comentÃ¡rio**:

Este Ã© o link do comentÃ¡rio do leandl que virou uma thread sensacional com espÃ­rito open source:

https://curso.dev/alunos/leandl/3988bdf7-3545-4163-a954-400595538126

### Fazendo deploy em HomologaÃ§Ã£o (Staging)

Pelo fato da gente nÃ£o somente saber criar branches, mas entender como elas realmente funcionam por baixo dos panos, isso possibilita agora a gente criar ambientes de HomologaÃ§Ã£o que em inglÃªs a turma lÃ¡ se refere como Staging e que a Vercel escolheu dar o nome de Preview, que nÃ£o deixa de ser uma prÃ©-visualizaÃ§Ã£o do que estÃ¡ para acontecer.

#### Let's code

```sh
curl -s https://clone-tabnews-diasjoaovitor.vercel.app/api/v1/status | python3 -m json.tool

curl -s -X GET http://localhost:3000/api/v1/migrations | python3 -m json.tool

curl -s -X GET https://clone-tabnews-diasjoaovitor.vercel.app/api/v1/migrations | python3 -m json.tool
```
